<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PDC Career Mode 2026</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&family=Roboto+Condensed:wght@400;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="icon.png">
    
    <style>
        :root {
            --pdc-red: #d50000;
            --pdc-dark-red: #9a0000;
            --pdc-blue: #0e2a3a;
            --pdc-bg: #0a0e1a;
            --pdc-gold: #ffd700;
            --text-grey: #8fa3ad;
            --pdc-green: #00b359;
            --card-bg: linear-gradient(145deg, #1a1f35, #0f1525);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #0a0e1a 0%, #1a1f35 50%, #0a0e1a 100%);
            background-attachment: fixed;
            color: white;
            font-family: 'Roboto', sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: linear-gradient(180deg, var(--pdc-gold), #cc9900); border-radius: 10px; }

        /* Header */
        .header {
            background: linear-gradient(180deg, rgba(12, 16, 28, 0.95), rgba(8, 11, 20, 0.9));
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--pdc-gold);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            font-size: 20px;
            color: var(--pdc-gold);
            font-family: 'Roboto Condensed', sans-serif;
        }

        .header-buttons {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
            font-family: 'Roboto Condensed', sans-serif;
            transition: all 0.3s;
        }

        .btn-gold {
            background: linear-gradient(135deg, var(--pdc-gold), #cc9900);
            color: black;
        }

        .btn-gold:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
        }

        .btn-secondary {
            background: #333;
            color: white;
            border: 1px solid #555;
        }

        .btn-secondary:hover {
            background: #444;
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        /* Screens */
        .screen {
            display: none;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }

        .screen.active {
            display: block;
        }

        /* Main Menu */
        #main-menu {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: calc(100vh - 80px);
            text-align: center;
        }

        .menu-title {
            font-size: 48px;
            font-weight: 900;
            color: var(--pdc-gold);
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
            margin-bottom: 10px;
        }

        .menu-subtitle {
            color: #888;
            font-size: 18px;
            margin-bottom: 40px;
        }

        .menu-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
            max-width: 300px;
        }

        .menu-btn {
            padding: 18px 30px;
            font-size: 18px;
            border-radius: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Character Creation */
        .creation-section {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 215, 0, 0.1);
        }

        .creation-section h2 {
            color: var(--pdc-gold);
            font-size: 18px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 215, 0, 0.2);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: #aaa;
            font-size: 12px;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            background: #0a0e1a;
            border: 1px solid #333;
            border-radius: 6px;
            color: white;
            font-size: 16px;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--pdc-gold);
        }

        .player-type-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
        }

        .type-btn {
            flex: 1;
            padding: 15px;
            background: #1a1f35;
            border: 2px solid #333;
            border-radius: 8px;
            color: #888;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .type-btn.active {
            border-color: var(--pdc-gold);
            color: var(--pdc-gold);
            background: rgba(255, 215, 0, 0.1);
        }

        .type-btn:hover {
            border-color: #555;
        }

        /* Stats Display */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .stat-box {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-box .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: var(--pdc-gold);
        }

        .stat-box .stat-label {
            font-size: 11px;
            color: #888;
            text-transform: uppercase;
            margin-top: 5px;
        }

        /* Player Card */
        .player-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 215, 0, 0.2);
        }

        .player-flag {
            width: 60px;
            height: 40px;
            border-radius: 4px;
            object-fit: cover;
        }

        .player-info h3 {
            font-size: 20px;
            color: white;
            margin-bottom: 5px;
        }

        .player-info p {
            color: #888;
            font-size: 14px;
        }

        .player-stats-bar {
            display: flex;
            gap: 20px;
            margin-left: auto;
        }

        .player-stat {
            text-align: center;
        }

        .player-stat .value {
            font-size: 18px;
            font-weight: bold;
            color: var(--pdc-gold);
        }

        .player-stat .label {
            font-size: 10px;
            color: #666;
            text-transform: uppercase;
        }

        /* Career Dashboard */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 600px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }

        .dashboard-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 215, 0, 0.1);
        }

        .dashboard-card h3 {
            color: var(--pdc-gold);
            font-size: 14px;
            text-transform: uppercase;
            margin-bottom: 15px;
        }

        /* Progress Bars */
        .progress-bar {
            background: #1a1f35;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .progress-fill.fatigue {
            background: linear-gradient(90deg, #e74c3c, #c0392b);
        }

        .progress-fill.form {
            background: linear-gradient(90deg, var(--pdc-green), #009944);
        }

        /* Event List */
        .event-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .event-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid transparent;
        }

        .event-item:hover {
            background: rgba(255, 215, 0, 0.05);
            border-color: rgba(255, 215, 0, 0.2);
        }

        .event-item.completed {
            opacity: 0.5;
        }

        .event-item.current {
            border-color: var(--pdc-gold);
            background: rgba(255, 215, 0, 0.1);
        }

        .event-item.ineligible {
            opacity: 0.4;
        }

        .event-date {
            width: 60px;
            text-align: center;
            font-size: 12px;
            color: #888;
        }

        .event-name {
            flex: 1;
            font-weight: bold;
            margin-left: 15px;
        }

        .event-status {
            font-size: 11px;
            padding: 4px 10px;
            border-radius: 4px;
            text-transform: uppercase;
        }

        .event-status.eligible {
            background: rgba(0, 179, 89, 0.2);
            color: var(--pdc-green);
        }

        .event-status.ineligible {
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
        }

        /* Free Time Actions */
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .action-btn {
            flex: 1;
            padding: 20px;
            background: var(--card-bg);
            border: 2px solid #333;
            border-radius: 12px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .action-btn:hover {
            border-color: var(--pdc-gold);
            transform: translateY(-2px);
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .action-btn .icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .action-btn .title {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 5px;
        }

        .action-btn .desc {
            font-size: 12px;
            color: #888;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.85);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-box {
            background: var(--card-bg);
            border: 2px solid var(--pdc-gold);
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-title {
            font-size: 20px;
            color: var(--pdc-gold);
            margin-bottom: 20px;
            text-align: center;
        }

        /* Standings Table */
        .standings-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        .standings-table th {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            text-align: left;
            color: #888;
            font-size: 11px;
            text-transform: uppercase;
        }

        .standings-table td {
            padding: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .standings-table tr.highlight {
            background: rgba(255, 215, 0, 0.1);
        }

        .standings-table tr.highlight td {
            color: var(--pdc-gold);
            font-weight: bold;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.3);
            padding: 5px;
            border-radius: 8px;
        }

        .tab-btn {
            flex: 1;
            padding: 10px;
            background: transparent;
            border: none;
            color: #888;
            cursor: pointer;
            border-radius: 6px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .tab-btn.active {
            background: var(--pdc-gold);
            color: black;
        }

        /* Existing Player Select */
        .player-select-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .player-select-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 6px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }

        .player-select-item:hover {
            background: rgba(255, 215, 0, 0.1);
        }

        .player-select-item.selected {
            border-color: var(--pdc-gold);
            background: rgba(255, 215, 0, 0.15);
        }

        .player-select-item img {
            width: 30px;
            height: 20px;
            margin-right: 12px;
            border-radius: 2px;
        }

        .player-select-item .name {
            flex: 1;
        }

        .player-select-item .avg {
            color: var(--pdc-gold);
            font-weight: bold;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--card-bg);
            border: 2px solid var(--pdc-gold);
            padding: 15px 30px;
            border-radius: 8px;
            z-index: 1001;
            display: none;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { top: 50px; opacity: 0; }
            to { top: 80px; opacity: 1; }
        }

        /* Search */
        .search-box {
            margin-bottom: 15px;
        }

        .search-box input {
            width: 100%;
            padding: 12px;
            background: #0a0e1a;
            border: 1px solid #333;
            border-radius: 6px;
            color: white;
            font-size: 14px;
        }

        /* Tournament Entry */
        .tournament-info {
            text-align: center;
            padding: 20px 0;
        }

        .tournament-info h2 {
            color: var(--pdc-gold);
            font-size: 24px;
            margin-bottom: 10px;
        }

        .tournament-info p {
            color: #888;
            margin-bottom: 5px;
        }

        .tournament-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
        }

        /* Week Display */
        .week-display {
            text-align: center;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .week-display .week {
            font-size: 14px;
            color: #888;
        }

        .week-display .date {
            font-size: 20px;
            color: var(--pdc-gold);
            font-weight: bold;
        }
    </style>
</head>

<body>
    <div class="header">
        <h1>ğŸ¯ PDC CAREER MODE</h1>
        <div class="header-buttons">
            <button class="btn btn-secondary" onclick="Career.saveGame()">ğŸ’¾ SAVE</button>
            <button class="btn btn-gold" onclick="AuthSystem.showModal()" style="background:#0066cc;">ğŸ‘¤ ACCOUNT</button>
            <button class="btn btn-secondary" onclick="location.href='darts.html'">ğŸ  MAIN</button>
        </div>
    </div>

    <!-- Main Menu Screen -->
    <div id="main-menu" class="screen active">
        <div class="menu-title">CAREER MODE</div>
        <div class="menu-subtitle">Write your own darts legacy</div>
        <div class="menu-buttons">
            <button class="btn btn-gold menu-btn" onclick="Career.showNewCareer()">ğŸ†• NEW CAREER</button>
            <button class="btn btn-secondary menu-btn" onclick="Career.loadGame()">ğŸ“‚ LOAD CAREER</button>
            <button class="btn btn-secondary menu-btn" onclick="location.href='darts.html'">â†©ï¸ BACK TO MAIN</button>
        </div>
    </div>

    <!-- Character Creation Screen -->
    <div id="create-screen" class="screen">
        <h2 style="color: var(--pdc-gold); margin-bottom: 20px;">CREATE YOUR CAREER</h2>
        
        <div class="player-type-toggle">
            <div class="type-btn active" id="type-custom" onclick="Career.setPlayerType('custom')">
                <div style="font-size: 24px; margin-bottom: 5px;">âœ¨</div>
                <div>Create Custom Player</div>
            </div>
            <div class="type-btn" id="type-existing" onclick="Career.setPlayerType('existing')">
                <div style="font-size: 24px; margin-bottom: 5px;">ğŸ‘¤</div>
                <div>Play as Existing Player</div>
            </div>
        </div>

        <!-- Custom Player Form -->
        <div id="custom-form" class="creation-section">
            <h2>Player Details</h2>
            <div class="form-group">
                <label>Player Name</label>
                <input type="text" id="player-name" placeholder="Enter your name" maxlength="30">
            </div>
            <div class="form-group">
                <label>Nationality</label>
                <select id="player-country">
                    <option value="england">ğŸ´ó §ó ¢ó ¥ó ®ó §ó ¿ England</option>
                    <option value="scotland">ğŸ´ó §ó ¢ó ³ó £ó ´ó ¿ Scotland</option>
                    <option value="wales">ğŸ´ó §ó ¢ó ·ó ¬ó ³ó ¿ Wales</option>
                    <option value="netherlands">ğŸ‡³ğŸ‡± Netherlands</option>
                    <option value="belgium">ğŸ‡§ğŸ‡ª Belgium</option>
                    <option value="germany">ğŸ‡©ğŸ‡ª Germany</option>
                    <option value="austria">ğŸ‡¦ğŸ‡¹ Austria</option>
                    <option value="australia">ğŸ‡¦ğŸ‡º Australia</option>
                    <option value="usa">ğŸ‡ºğŸ‡¸ United States</option>
                    <option value="canada">ğŸ‡¨ğŸ‡¦ Canada</option>
                    <option value="ireland">ğŸ‡®ğŸ‡ª Ireland</option>
                    <option value="northern ireland">ğŸ‡¬ğŸ‡§ Northern Ireland</option>
                    <option value="poland">ğŸ‡µğŸ‡± Poland</option>
                    <option value="czech republic">ğŸ‡¨ğŸ‡¿ Czech Republic</option>
                    <option value="hungary">ğŸ‡­ğŸ‡º Hungary</option>
                    <option value="portugal">ğŸ‡µğŸ‡¹ Portugal</option>
                    <option value="spain">ğŸ‡ªğŸ‡¸ Spain</option>
                    <option value="france">ğŸ‡«ğŸ‡· France</option>
                    <option value="japan">ğŸ‡¯ğŸ‡µ Japan</option>
                    <option value="philippines">ğŸ‡µğŸ‡­ Philippines</option>
                    <option value="china">ğŸ‡¨ğŸ‡³ China</option>
                    <option value="south africa">ğŸ‡¿ğŸ‡¦ South Africa</option>
                    <option value="new zealand">ğŸ‡³ğŸ‡¿ New Zealand</option>
                    <option value="sweden">ğŸ‡¸ğŸ‡ª Sweden</option>
                    <option value="denmark">ğŸ‡©ğŸ‡° Denmark</option>
                    <option value="norway">ğŸ‡³ğŸ‡´ Norway</option>
                    <option value="finland">ğŸ‡«ğŸ‡® Finland</option>
                    <option value="lithuania">ğŸ‡±ğŸ‡¹ Lithuania</option>
                    <option value="latvia">ğŸ‡±ğŸ‡» Latvia</option>
                    <option value="greece">ğŸ‡¬ğŸ‡· Greece</option>
                    <option value="italy">ğŸ‡®ğŸ‡¹ Italy</option>
                    <option value="croatia">ğŸ‡­ğŸ‡· Croatia</option>
                    <option value="slovakia">ğŸ‡¸ğŸ‡° Slovakia</option>
                    <option value="singapore">ğŸ‡¸ğŸ‡¬ Singapore</option>
                    <option value="hong kong">ğŸ‡­ğŸ‡° Hong Kong</option>
                    <option value="brazil">ğŸ‡§ğŸ‡· Brazil</option>
                </select>
            </div>
            <div class="form-group">
                <label>Starting Level</label>
                <select id="player-level" onchange="Career.updateStartingStats()">
                    <option value="amateur">Amateur (Avg: 65-70)</option>
                    <option value="semi-pro">Semi-Pro (Avg: 75-80)</option>
                    <option value="professional">Professional (Avg: 85-88)</option>
                </select>
            </div>
            
            <h2 style="margin-top: 25px;">Starting Stats</h2>
            <div class="stats-grid" id="starting-stats">
                <div class="stat-box">
                    <div class="stat-value" id="stat-avg">67.5</div>
                    <div class="stat-label">Average</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="stat-co">32%</div>
                    <div class="stat-label">Checkout %</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="stat-form">50</div>
                    <div class="stat-label">Form</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="stat-fatigue">0</div>
                    <div class="stat-label">Fatigue</div>
                </div>
            </div>
        </div>

        <!-- Existing Player Selection -->
        <div id="existing-form" class="creation-section" style="display: none;">
            <h2>Select Player</h2>
            <div class="search-box">
                <input type="text" id="player-search" placeholder="Search players..." oninput="Career.filterPlayers()">
            </div>
            <div class="player-select-list" id="player-list"></div>
        </div>

        <div style="display: flex; gap: 15px; margin-top: 20px;">
            <button class="btn btn-secondary" style="flex: 1;" onclick="Career.showMainMenu()">â† BACK</button>
            <button class="btn btn-gold" style="flex: 2;" onclick="Career.startCareer()">START CAREER â†’</button>
        </div>
    </div>

    <!-- Career Dashboard Screen -->
    <div id="dashboard-screen" class="screen">
        <!-- Player Card -->
        <div class="player-card" id="dashboard-player-card">
            <img class="player-flag" id="dash-flag" src="" alt="">
            <div class="player-info">
                <h3 id="dash-name">Player Name</h3>
                <p id="dash-rank">World Rank: #128</p>
            </div>
            <div class="player-stats-bar">
                <div class="player-stat">
                    <div class="value" id="dash-avg">85.0</div>
                    <div class="label">Average</div>
                </div>
                <div class="player-stat">
                    <div class="value" id="dash-co">38%</div>
                    <div class="label">Checkout</div>
                </div>
                <div class="player-stat">
                    <div class="value" id="dash-money">Â£0</div>
                    <div class="label">Earnings</div>
                </div>
            </div>
        </div>

        <!-- Week Display -->
        <div class="week-display">
            <div class="week">Week <span id="current-week">1</span> of 52</div>
            <div class="date" id="current-date">January 2026</div>
        </div>

        <!-- Status Bars -->
        <div class="dashboard-grid">
            <div class="dashboard-card">
                <h3>âš¡ Fatigue</h3>
                <div class="progress-bar">
                    <div class="progress-fill fatigue" id="fatigue-bar" style="width: 0%;"></div>
                </div>
                <div style="text-align: right; font-size: 12px; color: #888;"><span id="fatigue-value">0</span>/100</div>
            </div>
            <div class="dashboard-card">
                <h3>ğŸ”¥ Form</h3>
                <div class="progress-bar">
                    <div class="progress-fill form" id="form-bar" style="width: 50%;"></div>
                </div>
                <div style="text-align: right; font-size: 12px; color: #888;"><span id="form-value">50</span>/100</div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-btn active" onclick="Career.switchTab('schedule')">ğŸ“… Schedule</button>
            <button class="tab-btn" onclick="Career.switchTab('standings')">ğŸ† Standings</button>
            <button class="tab-btn" onclick="Career.switchTab('stats')">ğŸ“Š Stats</button>
        </div>

        <!-- Schedule Tab -->
        <div id="tab-schedule" class="tab-content">
            <div class="event-list" id="event-list"></div>
        </div>

        <!-- Standings Tab -->
        <div id="tab-standings" class="tab-content" style="display: none;">
            <div class="tabs" style="margin-bottom: 15px;">
                <button class="tab-btn active" onclick="Career.switchStandings('oom')">Order of Merit</button>
                <button class="tab-btn" onclick="Career.switchStandings('protour')">Pro Tour</button>
            </div>
            <div id="standings-content"></div>
        </div>

        <!-- Stats Tab -->
        <div id="tab-stats" class="tab-content" style="display: none;">
            <div class="creation-section">
                <h2>Career Statistics</h2>
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value" id="stats-played">0</div>
                        <div class="stat-label">Events Played</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="stats-wins">0</div>
                        <div class="stat-label">Titles Won</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="stats-finals">0</div>
                        <div class="stat-label">Finals</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="stats-semis">0</div>
                        <div class="stat-label">Semi-Finals</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="stats-180s">0</div>
                        <div class="stat-label">180s</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="stats-highco">0</div>
                        <div class="stat-label">Highest Checkout</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons" id="action-buttons">
            <button class="action-btn" onclick="Career.rest()" id="btn-rest">
                <div class="icon">ğŸ˜´</div>
                <div class="title">REST</div>
                <div class="desc">-20 Fatigue</div>
            </button>
            <button class="action-btn" onclick="Career.train()" id="btn-train">
                <div class="icon">ğŸ¯</div>
                <div class="title">TRAIN</div>
                <div class="desc">+Stats, +10 Fatigue</div>
            </button>
            <button class="action-btn" onclick="Career.advanceWeek()" id="btn-advance">
                <div class="icon">â­ï¸</div>
                <div class="title">NEXT WEEK</div>
                <div class="desc">Advance time</div>
            </button>
        </div>
    </div>

    <!-- Event Modal -->
    <div class="modal-overlay" id="event-modal">
        <div class="modal-box">
            <div class="tournament-info">
                <h2 id="modal-event-name">Tournament Name</h2>
                <p id="modal-event-date">Date</p>
                <p id="modal-event-type">Type</p>
                <p id="modal-event-players">Players: 128</p>
                <p id="modal-event-prize">Prize Pool: Â£500,000</p>
            </div>
            
            <div id="modal-eligibility" style="text-align: center; margin: 20px 0; padding: 15px; border-radius: 8px;"></div>
            
            <div class="tournament-actions">
                <button class="btn btn-secondary" onclick="Career.closeEventModal()">CLOSE</button>
                <button class="btn btn-gold" id="btn-enter-event" onclick="Career.enterEvent()">ENTER EVENT</button>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <!-- AUTH MODAL -->
    <div id="auth-modal"
        style="position:fixed; inset:0; background:rgba(0,0,0,0.85); z-index:10001; display:none; justify-content:center; align-items:center; padding:20px;">
        <div
            style="background:linear-gradient(145deg, #1a1f35, #0f1525); border:2px solid #ffd700; border-radius:12px; padding:25px; max-width:400px; width:100%; color:white;">
            <div style="font-size:18px; font-weight:bold; color:#ffd700; margin-bottom:15px; text-align:center;">ğŸ‘¤
                ACCOUNT</div>

            <!-- Login View (shown when not logged in) -->
            <div id="auth-login-view">
                <!-- Login Form -->
                <div id="auth-login-form">
                    <div style="margin-bottom:12px;">
                        <label style="font-size:11px; color:#aaa; display:block; margin-bottom:4px;">USERNAME</label>
                        <input type="text" id="login-username" placeholder="Enter username"
                            style="width:100%; padding:10px; background:#0a0e1a; border:1px solid #444; border-radius:4px; color:#fff; font-size:14px; box-sizing:border-box;">
                    </div>
                    <div style="margin-bottom:15px;">
                        <label style="font-size:11px; color:#aaa; display:block; margin-bottom:4px;">PASSWORD</label>
                        <input type="password" id="login-password" placeholder="Enter password"
                            style="width:100%; padding:10px; background:#0a0e1a; border:1px solid #444; border-radius:4px; color:#fff; font-size:14px; box-sizing:border-box;">
                    </div>
                    <button onclick="AuthSystem.login()"
                        style="width:100%; padding:12px; background:#0066cc; border:none; color:white; border-radius:4px; cursor:pointer; font-weight:bold; font-size:14px;">ğŸ”
                        LOGIN</button>
                    <div style="text-align:center; margin-top:12px;">
                        <span style="color:#888; font-size:12px;">Don't have an account? </span>
                        <a href="#" onclick="AuthSystem.switchToRegister(); return false;"
                            style="color:#ffd700; font-size:12px;">Register</a>
                    </div>
                </div>

                <!-- Register Form -->
                <div id="auth-register-form" style="display:none;">
                    <div style="margin-bottom:12px;">
                        <label style="font-size:11px; color:#aaa; display:block; margin-bottom:4px;">USERNAME</label>
                        <input type="text" id="reg-username" placeholder="Choose username (min 3 chars)"
                            style="width:100%; padding:10px; background:#0a0e1a; border:1px solid #444; border-radius:4px; color:#fff; font-size:14px; box-sizing:border-box;">
                    </div>
                    <div style="margin-bottom:12px;">
                        <label style="font-size:11px; color:#aaa; display:block; margin-bottom:4px;">PASSWORD</label>
                        <input type="password" id="reg-password" placeholder="Choose password (min 6 chars)"
                            style="width:100%; padding:10px; background:#0a0e1a; border:1px solid #444; border-radius:4px; color:#fff; font-size:14px; box-sizing:border-box;">
                    </div>
                    <div style="margin-bottom:15px;">
                        <label style="font-size:11px; color:#aaa; display:block; margin-bottom:4px;">CONFIRM
                            PASSWORD</label>
                        <input type="password" id="reg-confirm-password" placeholder="Confirm password"
                            style="width:100%; padding:10px; background:#0a0e1a; border:1px solid #444; border-radius:4px; color:#fff; font-size:14px; box-sizing:border-box;">
                    </div>
                    <button onclick="AuthSystem.register()"
                        style="width:100%; padding:12px; background:#00b359; border:none; color:white; border-radius:4px; cursor:pointer; font-weight:bold; font-size:14px;">ğŸ“
                        REGISTER</button>
                    <div style="text-align:center; margin-top:12px;">
                        <span style="color:#888; font-size:12px;">Already have an account? </span>
                        <a href="#" onclick="AuthSystem.switchToLogin(); return false;"
                            style="color:#ffd700; font-size:12px;">Login</a>
                    </div>
                </div>

                <div id="auth-error" style="color:#ff4444; font-size:12px; text-align:center; margin-top:10px;">
                </div>
            </div>

            <!-- Account View (shown when logged in) -->
            <div id="auth-account-view" style="display:none;">
                <div style="text-align:center; margin-bottom:20px;">
                    <div style="font-size:40px; margin-bottom:10px;">ğŸ‘¤</div>
                    <div style="font-size:16px; font-weight:bold; color:#fff;">Welcome, <span
                            id="auth-username-display"></span>!</div>
                    <div style="font-size:11px; color:#888; margin-top:5px;">Last sync: <span
                            id="auth-last-sync">Never</span></div>
                </div>

                <div style="display:flex; flex-direction:column; gap:10px; margin-bottom:20px;">
                    <button id="auth-save-btn" onclick="Career.saveToCloud()"
                        style="width:100%; padding:12px; background:#00b359; border:none; color:white; border-radius:4px; cursor:pointer; font-weight:bold;">ğŸ’¾
                        SAVE CAREER TO SERVER</button>
                    <button id="auth-load-btn" onclick="Career.loadFromCloud()"
                        style="width:100%; padding:12px; background:#0066cc; border:none; color:white; border-radius:4px; cursor:pointer; font-weight:bold;">ğŸ“¥
                        LOAD CAREER FROM SERVER</button>
                </div>

                <div
                    style="padding:12px; background:rgba(0,102,0,0.2); border:1px solid #00b359; border-radius:6px; margin-bottom:15px;">
                    <div style="font-size:11px; color:#00b359;">âœ“ Same account as main game</div>
                    <div style="font-size:11px; color:#888; margin-top:4px;">Career saves are stored separately from season saves
                    </div>
                </div>

                <button onclick="AuthSystem.logout()"
                    style="width:100%; padding:10px; background:#9a0000; border:none; color:white; border-radius:4px; cursor:pointer; font-weight:bold;">ğŸšª
                    LOGOUT</button>
            </div>

            <button onclick="AuthSystem.closeModal()"
                style="width:100%; padding:10px; background:#444; border:none; color:white; border-radius:4px; cursor:pointer; font-weight:bold; margin-top:15px;">CLOSE</button>
        </div>
    </div>

    <!-- Load shared module (Engine, Logic, AuthSystem, DataLoader) -->
    <script src="shared.js"></script>

    <script>
        // ==================== PLAYER DATABASE ====================
        // This will be populated from database or use defaults
        let PLAYERS_DB = [
            { name: "Luke Humphries", country: "england", avg: 98.5, co: 42, tourCard: true, money: 850000 },
            { name: "Luke Littler", country: "england", avg: 99.2, co: 44, tourCard: true, money: 780000 },
            { name: "Michael van Gerwen", country: "netherlands", avg: 97.8, co: 43, tourCard: true, money: 720000 },
            { name: "Gary Anderson", country: "scotland", avg: 96.5, co: 41, tourCard: true, money: 450000 },
            { name: "Gerwyn Price", country: "wales", avg: 95.8, co: 40, tourCard: true, money: 520000 },
            { name: "Rob Cross", country: "england", avg: 95.2, co: 39, tourCard: true, money: 480000 },
            { name: "Michael Smith", country: "england", avg: 96.0, co: 41, tourCard: true, money: 510000 },
            { name: "Peter Wright", country: "scotland", avg: 94.5, co: 38, tourCard: true, money: 380000 },
            { name: "Jonny Clayton", country: "wales", avg: 95.0, co: 40, tourCard: true, money: 420000 },
            { name: "Dave Chisnall", country: "england", avg: 94.8, co: 39, tourCard: true, money: 350000 },
            { name: "Nathan Aspinall", country: "england", avg: 94.2, co: 38, tourCard: true, money: 320000 },
            { name: "Damon Heta", country: "australia", avg: 93.8, co: 38, tourCard: true, money: 290000 },
            { name: "Danny Noppert", country: "netherlands", avg: 93.5, co: 39, tourCard: true, money: 280000 },
            { name: "Chris Dobey", country: "england", avg: 93.2, co: 37, tourCard: true, money: 260000 },
            { name: "Stephen Bunting", country: "england", avg: 93.0, co: 38, tourCard: true, money: 250000 },
            { name: "Dimitri Van den Bergh", country: "belgium", avg: 92.8, co: 37, tourCard: true, money: 240000 },
            { name: "Joe Cullen", country: "england", avg: 92.5, co: 36, tourCard: true, money: 220000 },
            { name: "Josh Rock", country: "northern ireland", avg: 93.5, co: 39, tourCard: true, money: 210000 },
            { name: "Martin Schindler", country: "germany", avg: 92.0, co: 36, tourCard: true, money: 180000 },
            { name: "Dirk van Duijvenbode", country: "netherlands", avg: 91.8, co: 35, tourCard: true, money: 170000 },
            { name: "Ryan Searle", country: "england", avg: 91.5, co: 36, tourCard: true, money: 160000 },
            { name: "James Wade", country: "england", avg: 91.2, co: 37, tourCard: true, money: 200000 },
            { name: "Ross Smith", country: "england", avg: 91.0, co: 35, tourCard: true, money: 150000 },
            { name: "Andrew Gilding", country: "england", avg: 90.8, co: 35, tourCard: true, money: 140000 },
            { name: "Krzysztof Ratajski", country: "poland", avg: 90.5, co: 34, tourCard: true, money: 130000 },
            { name: "Raymond van Barneveld", country: "netherlands", avg: 90.2, co: 36, tourCard: true, money: 180000 },
            { name: "Ricardo Pietreczko", country: "germany", avg: 90.0, co: 34, tourCard: true, money: 120000 },
            { name: "Brendan Dolan", country: "northern ireland", avg: 89.8, co: 35, tourCard: true, money: 115000 },
            { name: "Mensur Suljovic", country: "austria", avg: 89.5, co: 36, tourCard: true, money: 140000 },
            { name: "Kim Huybrechts", country: "belgium", avg: 89.2, co: 34, tourCard: true, money: 105000 },
        ];

        // Generate more players to fill the tour (only if not loaded from DB)
        function generateDefaultPlayers() {
            for (let i = 31; i <= 128; i++) {
                const countries = ['england', 'netherlands', 'scotland', 'wales', 'germany', 'belgium', 'australia', 'austria', 'poland', 'ireland'];
                PLAYERS_DB.push({
                    name: `Player ${i}`,
                    country: countries[Math.floor(Math.random() * countries.length)],
                    avg: 85 + Math.random() * 8,
                    co: 30 + Math.random() * 8,
                    tourCard: true,
                    money: Math.floor(50000 + Math.random() * 100000)
                });
            }
        }

        // ==================== EVENTS DATABASE ====================
        // Default events - will be replaced if loaded from database
        let EVENTS_DB = [
            { id: 1, name: "Bahrain Darts Masters", date: "Jan 09", type: "world-series", players: 8, prize: 60000, cardRequired: false, invitational: true },
            { id: 2, name: "Players Championship 1", date: "Jan 25", type: "players", players: 128, prize: 75000, cardRequired: true },
            { id: 3, name: "Players Championship 2", date: "Jan 26", type: "players", players: 128, prize: 75000, cardRequired: true },
            { id: 4, name: "UK Open Qualifier 1", date: "Feb 01", type: "qualifier", players: 128, prize: 10000, cardRequired: true },
            { id: 5, name: "Players Championship 3", date: "Feb 07", type: "players", players: 128, prize: 75000, cardRequired: true },
            { id: 6, name: "Players Championship 4", date: "Feb 08", type: "players", players: 128, prize: 75000, cardRequired: true },
            { id: 7, name: "UK Open", date: "Feb 28", type: "major", players: 128, prize: 500000, cardRequired: false, qualifierRequired: true },
            { id: 8, name: "Players Championship 5", date: "Mar 07", type: "players", players: 128, prize: 75000, cardRequired: true },
            { id: 9, name: "Players Championship 6", date: "Mar 08", type: "players", players: 128, prize: 75000, cardRequired: true },
            { id: 10, name: "Players Championship 7", date: "Mar 21", type: "players", players: 128, prize: 75000, cardRequired: true },
            { id: 11, name: "Players Championship 8", date: "Mar 22", type: "players", players: 128, prize: 75000, cardRequired: true },
            { id: 12, name: "European Tour 1", date: "Apr 04", type: "euro-tour", players: 48, prize: 175000, cardRequired: true },
            { id: 13, name: "Players Championship 9", date: "Apr 18", type: "players", players: 128, prize: 75000, cardRequired: true },
            { id: 14, name: "Players Championship 10", date: "Apr 19", type: "players", players: 128, prize: 75000, cardRequired: true },
            { id: 15, name: "World Cup of Darts", date: "May 01", type: "world-cup", players: 64, prize: 450000, cardRequired: false, teamEvent: true },
            { id: 16, name: "European Tour 2", date: "May 15", type: "euro-tour", players: 48, prize: 175000, cardRequired: true },
            { id: 17, name: "Players Championship 11", date: "May 30", type: "players", players: 128, prize: 75000, cardRequired: true },
            { id: 18, name: "Players Championship 12", date: "May 31", type: "players", players: 128, prize: 75000, cardRequired: true },
            { id: 19, name: "Nordic Darts Masters", date: "Jun 12", type: "world-series", players: 8, prize: 60000, cardRequired: false, invitational: true },
            { id: 20, name: "European Tour 3", date: "Jun 20", type: "euro-tour", players: 48, prize: 175000, cardRequired: true },
            { id: 21, name: "World Matchplay", date: "Jul 12", type: "major", players: 32, prize: 800000, cardRequired: false, top32: true },
            { id: 22, name: "World Series Finals", date: "Aug 01", type: "major", players: 24, prize: 300000, cardRequired: false, wsQualification: true },
            { id: 23, name: "European Tour 4", date: "Aug 15", type: "euro-tour", players: 48, prize: 175000, cardRequired: true },
            { id: 24, name: "Players Championship 13", date: "Aug 29", type: "players", players: 128, prize: 75000, cardRequired: true },
            { id: 25, name: "Players Championship 14", date: "Aug 30", type: "players", players: 128, prize: 75000, cardRequired: true },
            { id: 26, name: "World Grand Prix", date: "Oct 03", type: "major", players: 32, prize: 600000, cardRequired: false, top32: true },
            { id: 27, name: "European Championship", date: "Oct 24", type: "major", players: 32, prize: 500000, cardRequired: false, euroTourQual: true },
            { id: 28, name: "Players Championship Finals", date: "Nov 21", type: "major", players: 64, prize: 500000, cardRequired: false, pcQualification: true },
            { id: 29, name: "Grand Slam of Darts", date: "Nov 08", type: "major", players: 32, prize: 650000, cardRequired: false, gsQualification: true },
            { id: 30, name: "World Championship", date: "Dec 15", type: "major", players: 96, prize: 2500000, cardRequired: false, worldsQualification: true },
        ];

        // ==================== CAREER SYSTEM ====================
        const Career = {
            state: null,
            playerType: 'custom',
            selectedExistingPlayer: null,

            // Initialize career
            init: () => {
                Career.renderPlayerList();
            },

            // Show screens
            showScreen: (screenId) => {
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                document.getElementById(screenId).classList.add('active');
            },

            showMainMenu: () => {
                Career.showScreen('main-menu');
            },

            showNewCareer: () => {
                Career.showScreen('create-screen');
                Career.setPlayerType('custom');
            },

            // Player type toggle
            setPlayerType: (type) => {
                Career.playerType = type;
                document.getElementById('type-custom').classList.toggle('active', type === 'custom');
                document.getElementById('type-existing').classList.toggle('active', type === 'existing');
                document.getElementById('custom-form').style.display = type === 'custom' ? 'block' : 'none';
                document.getElementById('existing-form').style.display = type === 'existing' ? 'block' : 'none';
            },

            // Update starting stats based on level
            updateStartingStats: () => {
                const level = document.getElementById('player-level').value;
                let avg, co, form;
                
                switch(level) {
                    case 'amateur':
                        avg = (65 + Math.random() * 5).toFixed(1);
                        co = Math.floor(28 + Math.random() * 6);
                        form = 40;
                        break;
                    case 'semi-pro':
                        avg = (75 + Math.random() * 5).toFixed(1);
                        co = Math.floor(32 + Math.random() * 6);
                        form = 50;
                        break;
                    case 'professional':
                        avg = (85 + Math.random() * 3).toFixed(1);
                        co = Math.floor(36 + Math.random() * 5);
                        form = 60;
                        break;
                }
                
                document.getElementById('stat-avg').textContent = avg;
                document.getElementById('stat-co').textContent = co + '%';
                document.getElementById('stat-form').textContent = form;
            },

            // Render player list for existing player selection
            renderPlayerList: () => {
                const container = document.getElementById('player-list');
                if (!container) return;
                
                const searchTerm = (document.getElementById('player-search')?.value || '').toLowerCase();
                
                const filtered = PLAYERS_DB.filter(p => 
                    p.name.toLowerCase().includes(searchTerm)
                );
                
                container.innerHTML = filtered.map(p => {
                    const avgDisplay = (typeof p.avg === 'number') ? p.avg.toFixed(1) : '85.0';
                    return `
                        <div class="player-select-item ${Career.selectedExistingPlayer === p.name ? 'selected' : ''}" 
                             onclick="Career.selectExistingPlayer('${p.name.replace(/'/g, "\\'")}')">
                            <img src="https://flagcdn.com/w40/${Career.getCountryCode(p.country)}.png" 
                                 onerror="this.src='pdc-logo.png'">
                            <span class="name">${p.name}</span>
                            <span class="avg">${avgDisplay}</span>
                        </div>
                    `;
                }).join('');
            },

            filterPlayers: () => {
                Career.renderPlayerList();
            },

            selectExistingPlayer: (name) => {
                Career.selectedExistingPlayer = name;
                Career.renderPlayerList();
            },

            getCountryCode: (country) => {
                if (!country) return 'gb-eng';
                const c = country.toLowerCase().trim();
                
                // Short codes from database
                const shortCodes = {
                    'eng': 'gb-eng', 'sco': 'gb-sct', 'wal': 'gb-wls', 'nir': 'gb-nir',
                    'nl': 'nl', 'bel': 'be', 'ger': 'de', 'aut': 'at', 'aus': 'au',
                    'usa': 'us', 'can': 'ca', 'irl': 'ie', 'pl': 'pl', 'pol': 'pl',
                    'cze': 'cz', 'hun': 'hu', 'por': 'pt', 'esp': 'es', 'fra': 'fr',
                    'jpn': 'jp', 'phi': 'ph', 'chn': 'cn', 'rsa': 'za', 'nzl': 'nz',
                    'swe': 'se', 'den': 'dk', 'nor': 'no', 'fin': 'fi', 'lit': 'lt',
                    'lat': 'lv', 'gre': 'gr', 'ita': 'it', 'cro': 'hr', 'svk': 'sk',
                    'sgp': 'sg', 'hkg': 'hk', 'bra': 'br', 'sui': 'ch', 'rou': 'ro',
                    'ukr': 'ua', 'rus': 'ru', 'svn': 'si', 'srb': 'rs', 'mex': 'mx',
                    'arg': 'ar', 'col': 'co', 'chl': 'cl', 'tha': 'th', 'mys': 'my',
                    'ind': 'in', 'kor': 'kr', 'twn': 'tw', 'idn': 'id', 'gbr': 'gb'
                };
                
                // Full country names
                const fullNames = {
                    'england': 'gb-eng', 'scotland': 'gb-sct', 'wales': 'gb-wls',
                    'northern ireland': 'gb-nir', 'netherlands': 'nl', 'belgium': 'be',
                    'germany': 'de', 'austria': 'at', 'australia': 'au', 'usa': 'us',
                    'united states': 'us', 'canada': 'ca', 'ireland': 'ie', 'poland': 'pl',
                    'czech republic': 'cz', 'czechia': 'cz', 'hungary': 'hu', 
                    'portugal': 'pt', 'spain': 'es', 'france': 'fr', 'japan': 'jp',
                    'philippines': 'ph', 'china': 'cn', 'south africa': 'za',
                    'new zealand': 'nz', 'sweden': 'se', 'denmark': 'dk', 'norway': 'no',
                    'finland': 'fi', 'lithuania': 'lt', 'latvia': 'lv', 'greece': 'gr',
                    'italy': 'it', 'croatia': 'hr', 'slovakia': 'sk', 'singapore': 'sg',
                    'hong kong': 'hk', 'brazil': 'br', 'switzerland': 'ch', 'romania': 'ro',
                    'ukraine': 'ua', 'russia': 'ru', 'slovenia': 'si', 'serbia': 'rs',
                    'mexico': 'mx', 'argentina': 'ar', 'colombia': 'co', 'chile': 'cl',
                    'thailand': 'th', 'malaysia': 'my', 'india': 'in', 'south korea': 'kr',
                    'taiwan': 'tw', 'indonesia': 'id', 'united kingdom': 'gb'
                };
                
                return shortCodes[c] || fullNames[c] || 'gb-eng';
            },

            // Get short country code for eligibility checking
            getCountryShortCode: (country) => {
                if (!country) return 'eng';
                const c = country.toLowerCase().trim();
                
                // If already a short code, return it
                const shortCodes = ['eng', 'sco', 'wal', 'nir', 'irl', 'nl', 'bel', 'ger', 'aut', 'aus',
                    'usa', 'can', 'pl', 'pol', 'cze', 'hun', 'por', 'esp', 'fra', 'jpn', 'phi', 'chn',
                    'rsa', 'nzl', 'swe', 'den', 'nor', 'fin', 'lit', 'lat', 'gre', 'ita', 'cro', 'svk',
                    'sgp', 'hkg', 'bra', 'sui', 'rou', 'ukr', 'rus', 'svn', 'srb', 'mex', 'arg', 'col',
                    'chl', 'tha', 'mys', 'ind', 'kor', 'twn', 'idn', 'gbr'];
                if (shortCodes.includes(c)) return c;
                
                // Convert full names to short codes
                const fullToShort = {
                    'england': 'eng', 'scotland': 'sco', 'wales': 'wal',
                    'northern ireland': 'nir', 'ireland': 'irl', 'netherlands': 'nl',
                    'belgium': 'bel', 'germany': 'ger', 'austria': 'aut', 'australia': 'aus',
                    'usa': 'usa', 'united states': 'usa', 'canada': 'can', 'poland': 'pl',
                    'czech republic': 'cze', 'czechia': 'cze', 'hungary': 'hun',
                    'portugal': 'por', 'spain': 'esp', 'france': 'fra', 'japan': 'jpn',
                    'philippines': 'phi', 'china': 'chn', 'south africa': 'rsa',
                    'new zealand': 'nzl', 'sweden': 'swe', 'denmark': 'den', 'norway': 'nor',
                    'finland': 'fin', 'lithuania': 'lit', 'latvia': 'lat', 'greece': 'gre',
                    'italy': 'ita', 'croatia': 'cro', 'slovakia': 'svk', 'singapore': 'sgp',
                    'hong kong': 'hkg', 'brazil': 'bra', 'switzerland': 'sui', 'romania': 'rou',
                    'ukraine': 'ukr', 'russia': 'rus', 'slovenia': 'svn', 'serbia': 'srb',
                    'mexico': 'mex', 'argentina': 'arg', 'colombia': 'col', 'chile': 'chl',
                    'thailand': 'tha', 'malaysia': 'mys', 'india': 'ind', 'south korea': 'kor',
                    'taiwan': 'twn', 'indonesia': 'idn', 'united kingdom': 'gbr'
                };
                
                return fullToShort[c] || 'eng';
            },

            // Start new career
            startCareer: () => {
                let player;
                
                if (Career.playerType === 'custom') {
                    const name = document.getElementById('player-name').value.trim();
                    if (!name) {
                        Career.notify('Please enter a player name!', 'error');
                        return;
                    }
                    
                    const country = document.getElementById('player-country').value;
                    const avg = parseFloat(document.getElementById('stat-avg').textContent);
                    const co = parseInt(document.getElementById('stat-co').textContent);
                    const form = parseInt(document.getElementById('stat-form').textContent);
                    const level = document.getElementById('player-level').value;
                    
                    player = {
                        name: name,
                        country: country,
                        avg: avg,
                        co: co,
                        form: form,
                        fatigue: 0,
                        money: 0,
                        tourCard: level === 'professional',
                        isCustom: true
                    };
                } else {
                    if (!Career.selectedExistingPlayer) {
                        Career.notify('Please select a player!', 'error');
                        return;
                    }
                    
                    const existing = PLAYERS_DB.find(p => p.name === Career.selectedExistingPlayer);
                    player = {
                        ...existing,
                        form: 60 + Math.random() * 20,
                        fatigue: 0,
                        isCustom: false
                    };
                }
                
                // Initialize career state
                Career.state = {
                    player: player,
                    week: 1,
                    year: 2026,
                    events: JSON.parse(JSON.stringify(EVENTS_DB)),
                    completedEvents: [],
                    currentEventIndex: 0,
                    stats: {
                        eventsPlayed: 0,
                        wins: 0,
                        finals: 0,
                        semiFinals: 0,
                        total180s: 0,
                        highestCheckout: 0,
                        matchesWon: 0,
                        matchesLost: 0
                    },
                    orderOfMerit: {},
                    proTourOOM: {},
                    qualifications: {
                        ukOpen: false,
                        worldMatchplay: false,
                        worldGrandPrix: false,
                        euroChamp: false,
                        pcFinals: false,
                        grandSlam: false,
                        worldSeries: false,
                        worlds: false,
                        winmauMasters: false
                    }
                };
                
                // Initialize OOM with existing players
                PLAYERS_DB.forEach(p => {
                    Career.state.orderOfMerit[p.name] = p.money || 0;
                });
                Career.state.orderOfMerit[player.name] = player.money || 0;
                
                Career.showScreen('dashboard-screen');
                Career.renderDashboard();
                Career.notify('Career started! Good luck on your journey!', 'success');
            },

            // Render dashboard
            renderDashboard: () => {
                if (!Career.state) return;
                
                const p = Career.state.player;
                
                // Player card
                document.getElementById('dash-flag').src = `https://flagcdn.com/w80/${Career.getCountryCode(p.country)}.png`;
                document.getElementById('dash-name').textContent = p.name;
                document.getElementById('dash-rank').textContent = `World Rank: #${Career.getWorldRank()}`;
                document.getElementById('dash-avg').textContent = p.avg.toFixed(1);
                document.getElementById('dash-co').textContent = Math.round(p.co) + '%';
                document.getElementById('dash-money').textContent = 'Â£' + p.money.toLocaleString();
                
                // Week/Date
                document.getElementById('current-week').textContent = Career.state.week;
                document.getElementById('current-date').textContent = Career.getDateFromWeek(Career.state.week);
                
                // Fatigue & Form bars
                document.getElementById('fatigue-bar').style.width = p.fatigue + '%';
                document.getElementById('fatigue-value').textContent = Math.round(p.fatigue);
                document.getElementById('form-bar').style.width = p.form + '%';
                document.getElementById('form-value').textContent = Math.round(p.form);
                
                // Stats
                document.getElementById('stats-played').textContent = Career.state.stats.eventsPlayed;
                document.getElementById('stats-wins').textContent = Career.state.stats.wins;
                document.getElementById('stats-finals').textContent = Career.state.stats.finals;
                document.getElementById('stats-semis').textContent = Career.state.stats.semiFinals;
                document.getElementById('stats-180s').textContent = Career.state.stats.total180s;
                document.getElementById('stats-highco').textContent = Career.state.stats.highestCheckout;
                
                // Event list
                Career.renderEventList();
                
                // Update button states
                Career.updateActionButtons();
            },

            getWorldRank: () => {
                const sorted = Object.entries(Career.state.orderOfMerit)
                    .sort((a, b) => b[1] - a[1]);
                const rank = sorted.findIndex(e => e[0] === Career.state.player.name) + 1;
                return rank || 128;
            },

            getDateFromWeek: (week) => {
                const months = ['January', 'February', 'March', 'April', 'May', 'June', 
                               'July', 'August', 'September', 'October', 'November', 'December'];
                const monthIndex = Math.floor((week - 1) / 4.33);
                return months[Math.min(monthIndex, 11)] + ' ' + Career.state.year;
            },

            // Render event list
            renderEventList: () => {
                const container = document.getElementById('event-list');
                const currentWeek = Career.state.week;
                
                container.innerHTML = Career.state.events.map((ev, idx) => {
                    const isCompleted = Career.state.completedEvents.find(c => c.id === ev.id);
                    const isCurrent = idx === Career.state.currentEventIndex && !isCompleted;
                    const eligibility = Career.checkEligibility(ev);
                    
                    let statusClass = '';
                    let statusText = '';
                    
                    if (isCompleted) {
                        statusClass = 'completed';
                        statusText = `<span class="event-status" style="background:#333;color:#888;">âœ“ ${isCompleted.result}</span>`;
                    } else if (eligibility.eligible) {
                        statusText = `<span class="event-status eligible">âœ“ Eligible</span>`;
                    } else {
                        statusClass = 'ineligible';
                        statusText = `<span class="event-status ineligible">âœ— ${eligibility.reason}</span>`;
                    }
                    
                    return `
                        <div class="event-item ${statusClass} ${isCurrent ? 'current' : ''}" 
                             onclick="Career.showEventModal(${idx})">
                            <div class="event-date">${ev.date}</div>
                            <div class="event-name">${ev.name}</div>
                            ${statusText}
                        </div>
                    `;
                }).join('');
            },

            // Check eligibility for an event (matches darts.html logic)
            checkEligibility: (event) => {
                const p = Career.state.player;
                const rank = Career.getWorldRank();
                const type = event.type || '';
                const playerCountry = Career.getCountryShortCode(p.country);
                
                // Q-School: Must NOT have tour card, must be in eligible region
                if (type === 'q-school') {
                    if (p.tourCard) {
                        return { eligible: false, reason: 'Tour Card holders cannot enter' };
                    }
                    if (event.eligibleRegions && event.eligibleRegions.length > 0) {
                        if (!event.eligibleRegions.includes(playerCountry)) {
                            return { eligible: false, reason: `Not in eligible region (${event.location?.toUpperCase() || 'Region'})` };
                        }
                    }
                    return { eligible: true, reason: '' };
                }
                
                // Challenge Tour: Must NOT have tour card
                if (type === 'challenge') {
                    if (p.tourCard) {
                        return { eligible: false, reason: 'Tour Card holders cannot enter' };
                    }
                    return { eligible: true, reason: '' };
                }
                
                // Tour card required events (Players Championship, Premier League, most events)
                if (event.cardRequired && !p.tourCard) {
                    return { eligible: false, reason: 'No Tour Card' };
                }
                
                // Premier League - Top 8 only (invitation based)
                if (type === 'premier-league' || type === 'premier-league-playoff') {
                    if (rank > 8) {
                        return { eligible: false, reason: 'Top 8 Only (Invitation)' };
                    }
                    return { eligible: true, reason: '' };
                }
                
                // World Masters qualifiers - open to all
                if (type === 'wmasters-qual') {
                    return { eligible: true, reason: '' };
                }
                
                // Winmau World Masters - Tour card required, qualification based
                if (type === 'winmaudm') {
                    if (!p.tourCard) {
                        return { eligible: false, reason: 'No Tour Card' };
                    }
                    if (!Career.state.qualifications.winmauMasters && rank > 24) {
                        return { eligible: false, reason: 'Not Qualified (Need top 24 or qualifier win)' };
                    }
                    return { eligible: true, reason: '' };
                }
                
                // Masters events (World Series) - Top 16 invitation
                if (type === 'masters') {
                    if (rank > 16) {
                        return { eligible: false, reason: 'Top 16 Only (Invitation)' };
                    }
                    return { eligible: true, reason: '' };
                }
                
                // ET Qualifiers - various requirements
                if (type === 'et-qual-tc') {
                    if (!p.tourCard) {
                        return { eligible: false, reason: 'No Tour Card' };
                    }
                    return { eligible: true, reason: '' };
                }
                
                if (type === 'et-host-nation' || type === 'et-east-european' || type === 'et-nordic-baltic') {
                    // Regional qualifiers - check if player is from eligible region
                    if (event.eligibleRegions && event.eligibleRegions.length > 0) {
                        if (!event.eligibleRegions.includes(playerCountry)) {
                            return { eligible: false, reason: 'Not in eligible region' };
                        }
                    }
                    return { eligible: true, reason: '' };
                }
                
                // European Tour (Minor) events - Tour card required
                if (type === 'minor') {
                    if (!p.tourCard) {
                        return { eligible: false, reason: 'No Tour Card' };
                    }
                    return { eligible: true, reason: '' };
                }
                
                // UK Open - Open entry but ranked players get better seeding
                if (type === 'uk-open') {
                    return { eligible: true, reason: '' };
                }
                
                // World Matchplay - Top 16 OOM + Top 16 Pro Tour
                if (type === 'matchplay') {
                    if (rank > 32) {
                        return { eligible: false, reason: 'Not in Top 32' };
                    }
                    return { eligible: true, reason: '' };
                }
                
                // World Grand Prix - Top 32 OOM (double start format)
                if (type === 'grandprix') {
                    if (rank > 32) {
                        return { eligible: false, reason: 'Not in Top 32' };
                    }
                    return { eligible: true, reason: '' };
                }
                
                // European Championship - Top 32 European Order of Merit
                if (type === 'european-championship') {
                    if (rank > 32) {
                        return { eligible: false, reason: 'Not in Top 32' };
                    }
                    return { eligible: true, reason: '' };
                }
                
                // Players Championship Finals - Top 64 Pro Tour Order of Merit
                if (type === 'pc-finals') {
                    if (rank > 64 && !Career.state.qualifications.pcFinals) {
                        return { eligible: false, reason: 'Not in Top 64 Pro Tour' };
                    }
                    return { eligible: true, reason: '' };
                }
                
                // Grand Slam - Major winners + qualifiers
                if (type === 'grand-slam' || type === 'grandslam') {
                    if (!Career.state.qualifications.grandSlam && rank > 16) {
                        return { eligible: false, reason: 'Not Qualified (Need major win or top ranking)' };
                    }
                    return { eligible: true, reason: '' };
                }
                
                // World Series Finals - World Series qualifiers
                if (type === 'ws-finals') {
                    if (!Career.state.qualifications.worldSeries && rank > 24) {
                        return { eligible: false, reason: 'Not Qualified' };
                    }
                    return { eligible: true, reason: '' };
                }
                
                // World Championship - Top 32 + qualifiers
                if (type === 'world') {
                    if (rank > 32 && !Career.state.qualifications.worlds) {
                        return { eligible: false, reason: 'Not Qualified (Need Top 32 or qualifier)' };
                    }
                    return { eligible: true, reason: '' };
                }
                
                // World Championship qualifiers
                if (type === 'wc-qual-intl' || type === 'wc-qual-tc') {
                    if (type === 'wc-qual-tc' && !p.tourCard) {
                        return { eligible: false, reason: 'No Tour Card' };
                    }
                    return { eligible: true, reason: '' };
                }
                
                // Grand Slam / World Series qualifiers
                if (type === 'gs-qual-tc' || type === 'ws-qual-tc') {
                    if (!p.tourCard) {
                        return { eligible: false, reason: 'No Tour Card' };
                    }
                    return { eligible: true, reason: '' };
                }
                
                // Default: eligible if has tour card or event doesn't require it
                return { eligible: true, reason: '' };
            },

            // Show event modal
            showEventModal: (idx) => {
                const ev = Career.state.events[idx];
                Career.currentEventIdx = idx;
                
                document.getElementById('modal-event-name').textContent = ev.name;
                document.getElementById('modal-event-date').textContent = ev.date;
                document.getElementById('modal-event-type').textContent = (ev.type || 'event').toUpperCase().replace(/-/g, ' ');
                document.getElementById('modal-event-players').textContent = `Players: ${ev.players}`;
                document.getElementById('modal-event-prize').textContent = ev.prize > 0 ? `Prize Pool: Â£${ev.prize.toLocaleString()}` : 'No Prize Money';
                
                const eligibility = Career.checkEligibility(ev);
                const eligDiv = document.getElementById('modal-eligibility');
                const enterBtn = document.getElementById('btn-enter-event');
                
                const isCompleted = Career.state.completedEvents.find(c => c.id === ev.id);
                
                if (isCompleted) {
                    eligDiv.style.background = 'rgba(100, 100, 100, 0.2)';
                    eligDiv.innerHTML = `<span style="color:#888;">âœ“ Completed - ${isCompleted.result}</span>`;
                    enterBtn.style.display = 'none';
                } else if (eligibility.eligible) {
                    eligDiv.style.background = 'rgba(0, 179, 89, 0.2)';
                    eligDiv.innerHTML = `<span style="color:var(--pdc-green);">âœ“ You are eligible to enter this event</span>`;
                    enterBtn.style.display = 'block';
                    enterBtn.disabled = false;
                } else {
                    eligDiv.style.background = 'rgba(231, 76, 60, 0.2)';
                    eligDiv.innerHTML = `<span style="color:#e74c3c;">âœ— ${eligibility.reason}</span>`;
                    enterBtn.style.display = 'none';
                }
                
                document.getElementById('event-modal').classList.add('active');
            },

            closeEventModal: () => {
                document.getElementById('event-modal').classList.remove('active');
            },

            // Enter event (simplified simulation)
            enterEvent: () => {
                Career.closeEventModal();
                
                const ev = Career.state.events[Career.currentEventIdx];
                const p = Career.state.player;
                
                // Add fatigue for playing
                p.fatigue = Math.min(100, p.fatigue + 15);
                
                // Simulate tournament result based on player skill
                const result = Career.simulateTournament(ev);
                
                // Record result
                Career.state.completedEvents.push({
                    id: ev.id,
                    name: ev.name,
                    result: result.position,
                    prize: result.prize
                });
                
                // Update stats
                Career.state.stats.eventsPlayed++;
                p.money += result.prize;
                Career.state.orderOfMerit[p.name] = (Career.state.orderOfMerit[p.name] || 0) + result.prize;
                
                if (result.position === '1st') {
                    Career.state.stats.wins++;
                    Career.state.stats.finals++;
                } else if (result.position === '2nd') {
                    Career.state.stats.finals++;
                } else if (result.position.includes('SF')) {
                    Career.state.stats.semiFinals++;
                }
                
                // Update form based on result
                if (result.position === '1st') p.form = Math.min(100, p.form + 10);
                else if (result.position === '2nd') p.form = Math.min(100, p.form + 5);
                else if (result.position.includes('QF')) p.form = Math.min(100, p.form + 2);
                else p.form = Math.max(0, p.form - 2);
                
                // Check qualifications
                Career.updateQualifications(ev, result.position);
                
                // Move to next event
                Career.state.currentEventIndex++;
                
                Career.renderDashboard();
                Career.notify(`${ev.name}: ${result.position} - Â£${result.prize.toLocaleString()}`, 'success');
            },

            // Simplified tournament simulation
            simulateTournament: (event) => {
                const p = Career.state.player;
                const effectiveAvg = p.avg * (1 - p.fatigue / 200) * (0.8 + p.form / 250);
                
                // Calculate probability based on effective average vs field
                const fieldStrength = 92; // Average field strength
                const skillDiff = effectiveAvg - fieldStrength;
                
                // Base probability of winning
                let winProb = 0.02 + (skillDiff / 100) * 0.3;
                winProb = Math.max(0.001, Math.min(0.5, winProb));
                
                const rand = Math.random();
                
                // Determine position
                let position, prize;
                
                if (rand < winProb) {
                    position = '1st';
                    prize = Math.floor(event.prize * 0.2);
                } else if (rand < winProb * 3) {
                    position = '2nd';
                    prize = Math.floor(event.prize * 0.1);
                } else if (rand < winProb * 6) {
                    position = 'SF';
                    prize = Math.floor(event.prize * 0.05);
                } else if (rand < winProb * 12) {
                    position = 'QF';
                    prize = Math.floor(event.prize * 0.025);
                } else if (rand < winProb * 24) {
                    position = 'L16';
                    prize = Math.floor(event.prize * 0.0125);
                } else if (rand < winProb * 48) {
                    position = 'L32';
                    prize = Math.floor(event.prize * 0.006);
                } else {
                    position = 'L64';
                    prize = Math.floor(event.prize * 0.003);
                }
                
                return { position, prize };
            },

            // Update qualifications based on results
            updateQualifications: (event, position) => {
                const type = event.type || '';
                const isWin = position === '1st';
                const isFinal = position === '1st' || position === '2nd';
                const isSF = position === 'SF' || isFinal;
                
                // Q-School win gives Tour Card
                if (type === 'q-school' && isWin) {
                    Career.state.player.tourCard = true;
                    Career.notify('ğŸ‰ You earned a PDC Tour Card!', 'success');
                }
                
                // Winmau World Masters qualifier win
                if (type === 'wmasters-qual' && isWin) {
                    Career.state.qualifications.winmauMasters = true;
                }
                
                // European Tour (Minor) wins/finals qualify for European Championship
                if (type === 'minor' && isFinal) {
                    Career.state.qualifications.euroChamp = true;
                }
                
                // Players Championship good performances qualify for PC Finals
                if (type === 'players' && isSF) {
                    Career.state.qualifications.pcFinals = true;
                }
                
                // Masters (World Series) event wins qualify for WS Finals
                if (type === 'masters' && isWin) {
                    Career.state.qualifications.worldSeries = true;
                }
                
                // Major wins qualify for Grand Slam
                const majorTypes = ['matchplay', 'grandprix', 'uk-open', 'european-championship', 'world', 'pc-finals', 'ws-finals', 'winmaudm'];
                if (majorTypes.includes(type) && isWin) {
                    Career.state.qualifications.grandSlam = true;
                }
                
                // Challenge Tour good performances
                if (type === 'challenge' && isWin) {
                    // Challenge Tour winners can qualify for various events
                    Career.state.qualifications.pcFinals = true;
                }
                
                // World Championship qualifiers
                if ((type === 'wc-qual-intl' || type === 'wc-qual-tc') && isWin) {
                    Career.state.qualifications.worlds = true;
                }
                
                // Grand Slam qualifiers
                if (type === 'gs-qual-tc' && isWin) {
                    Career.state.qualifications.grandSlam = true;
                }
                
                // World Series qualifiers
                if (type === 'ws-qual-tc' && isWin) {
                    Career.state.qualifications.worldSeries = true;
                }
                
                // Top 32 in OOM qualifies for worlds
                if (Career.getWorldRank() <= 32) {
                    Career.state.qualifications.worlds = true;
                }
                
                // Top 64 qualifies for PC Finals
                if (Career.getWorldRank() <= 64) {
                    Career.state.qualifications.pcFinals = true;
                }
            },

            // Tab switching
            switchTab: (tab) => {
                document.querySelectorAll('.tab-content').forEach(t => t.style.display = 'none');
                document.querySelectorAll('.tabs .tab-btn').forEach(b => b.classList.remove('active'));
                
                document.getElementById('tab-' + tab).style.display = 'block';
                event.target.classList.add('active');
                
                if (tab === 'standings') {
                    Career.renderStandings('oom');
                }
            },

            switchStandings: (type) => {
                document.querySelectorAll('#tab-standings .tabs .tab-btn').forEach(b => b.classList.remove('active'));
                event.target.classList.add('active');
                Career.renderStandings(type);
            },

            renderStandings: (type) => {
                const container = document.getElementById('standings-content');
                const data = type === 'oom' ? Career.state.orderOfMerit : Career.state.proTourOOM;
                
                const sorted = Object.entries(data).sort((a, b) => b[1] - a[1]).slice(0, 50);
                const playerName = Career.state.player.name;
                
                container.innerHTML = `
                    <table class="standings-table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Player</th>
                                <th>Prize Money</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${sorted.map(([name, money], idx) => `
                                <tr class="${name === playerName ? 'highlight' : ''}">
                                    <td>${idx + 1}</td>
                                    <td>${name}</td>
                                    <td>Â£${money.toLocaleString()}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            },

            // Free time actions
            rest: () => {
                const p = Career.state.player;
                p.fatigue = Math.max(0, p.fatigue - 20);
                Career.advanceWeek();
                Career.notify('You rested. Fatigue reduced by 20.', 'success');
            },

            train: () => {
                const p = Career.state.player;
                
                // Training effects
                const avgGain = 0.05 + Math.random() * 0.1;
                const coGain = 0.1 + Math.random() * 0.2;
                
                p.avg = Math.min(100, p.avg + avgGain);
                p.co = Math.min(50, p.co + coGain);
                p.fatigue = Math.min(100, p.fatigue + 10);
                
                Career.advanceWeek();
                Career.notify(`Training complete! Avg +${avgGain.toFixed(2)}, CO +${coGain.toFixed(1)}%`, 'success');
            },

            advanceWeek: () => {
                Career.state.week++;
                
                // Natural fatigue recovery
                Career.state.player.fatigue = Math.max(0, Career.state.player.fatigue - 5);
                
                // Year rollover
                if (Career.state.week > 52) {
                    Career.state.week = 1;
                    Career.state.year++;
                    Career.notify('Happy New Year! Season ' + Career.state.year + ' begins!', 'success');
                }
                
                Career.renderDashboard();
            },

            updateActionButtons: () => {
                const p = Career.state.player;
                document.getElementById('btn-rest').disabled = p.fatigue <= 0;
                document.getElementById('btn-train').disabled = p.fatigue >= 90;
            },

            // Notifications
            notify: (message, type = 'info') => {
                const notif = document.getElementById('notification');
                notif.textContent = message;
                notif.style.display = 'block';
                notif.style.borderColor = type === 'error' ? '#e74c3c' : type === 'success' ? 'var(--pdc-green)' : 'var(--pdc-gold)';
                
                setTimeout(() => {
                    notif.style.display = 'none';
                }, 3000);
            },

            // Save/Load with differentiation from season mode
            saveGame: () => {
                if (!Career.state) {
                    Career.notify('No career to save!', 'error');
                    return;
                }
                
                const saveData = {
                    type: 'career', // Differentiates from season saves
                    version: '1.0',
                    timestamp: Date.now(),
                    state: Career.state
                };
                
                localStorage.setItem('pdc_career_save', JSON.stringify(saveData));
                Career.notify('Career saved locally!', 'success');
                
                // Also save to cloud if logged in
                if (AuthSystem.currentUser) {
                    Career.saveToCloud().catch(e => console.log('Auto-save to cloud failed:', e.message));
                }
            },

            // Cloud save using shared AuthSystem
            saveToCloud: async () => {
                if (!AuthSystem.currentUser) {
                    Career.notify('Please log in to save to server', 'error');
                    return;
                }
                if (!Career.state) {
                    Career.notify('No career to save!', 'error');
                    return;
                }

                try {
                    const saveBtn = document.getElementById('auth-save-btn');
                    if (saveBtn) saveBtn.innerText = 'â³ Saving...';

                    const careerState = {
                        type: 'career',
                        version: '1.0',
                        state: Career.state,
                        savedAt: Date.now()
                    };

                    const result = await AuthSystem.saveCareerToCloud(careerState);

                    if (result.success) {
                        if (saveBtn) {
                            saveBtn.innerText = 'âœ“ Saved!';
                            setTimeout(() => saveBtn.innerText = 'ğŸ’¾ SAVE CAREER TO SERVER', 2000);
                        }
                        document.getElementById('auth-last-sync').innerText = new Date().toLocaleString();
                        Career.notify('Career saved to server!', 'success');
                    } else {
                        throw new Error(result.error || 'Save failed');
                    }
                } catch (e) {
                    console.error('Save error:', e);
                    Career.notify('Failed to save. Check connection.', 'error');
                    const saveBtn = document.getElementById('auth-save-btn');
                    if (saveBtn) saveBtn.innerText = 'ğŸ’¾ SAVE CAREER TO SERVER';
                }
            },

            // Cloud load using shared AuthSystem
            loadFromCloud: async () => {
                if (!AuthSystem.currentUser) {
                    Career.notify('Please log in to load from server', 'error');
                    return false;
                }

                try {
                    const loadBtn = document.getElementById('auth-load-btn');
                    if (loadBtn) loadBtn.innerText = 'â³ Loading...';

                    const result = await AuthSystem.loadCareerFromCloud();

                    if (result.success && result.data && result.data.state) {
                        Career.state = result.data.state;
                        
                        // Also save locally
                        localStorage.setItem('pdc_career_save', JSON.stringify(result.data));
                        
                        Career.showScreen('dashboard-screen');
                        Career.renderDashboard();

                        if (loadBtn) {
                            loadBtn.innerText = 'âœ“ Loaded!';
                            setTimeout(() => loadBtn.innerText = 'ğŸ“¥ LOAD CAREER FROM SERVER', 2000);
                        }
                        Career.notify('Career loaded from server!', 'success');
                        return true;
                    } else {
                        if (loadBtn) loadBtn.innerText = 'ğŸ“¥ LOAD CAREER FROM SERVER';
                        Career.notify('No career save found on server', 'error');
                        return false;
                    }
                } catch (e) {
                    console.error('Load error:', e);
                    const loadBtn = document.getElementById('auth-load-btn');
                    if (loadBtn) loadBtn.innerText = 'ğŸ“¥ LOAD CAREER FROM SERVER';
                    Career.notify('Failed to load. Check connection.', 'error');
                    return false;
                }
            },

            loadGame: () => {
                try {
                    const saveJson = localStorage.getItem('pdc_career_save');
                    if (!saveJson) {
                        Career.notify('No saved career found!', 'error');
                        return;
                    }
                    
                    const saveData = JSON.parse(saveJson);
                    
                    // Verify it's a career save
                    if (saveData.type !== 'career') {
                        Career.notify('Invalid save data!', 'error');
                        return;
                    }
                    
                    Career.state = saveData.state;
                    Career.showScreen('dashboard-screen');
                    Career.renderDashboard();
                    Career.notify('Career loaded successfully!', 'success');
                    
                } catch (e) {
                    console.error('Load error:', e);
                    Career.notify('Failed to load career!', 'error');
                }
            },

            // Delete career save
            deleteSave: () => {
                if (confirm('Are you sure you want to delete your career save?')) {
                    localStorage.removeItem('pdc_career_save');
                    Career.notify('Career save deleted.', 'success');
                }
            }
        };

        // Initialize on load - load from database first
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                console.log("[Career] Initializing career mode...");
                
                // Try to load players and tournaments from database
                const [dbPlayers, dbTournaments] = await Promise.all([
                    DataLoader.loadPlayers(),
                    DataLoader.loadTournaments()
                ]);

                // If we got players from DB, use them
                if (dbPlayers && dbPlayers.length > 0) {
                    PLAYERS_DB = dbPlayers.map(p => ({
                        name: p.name,
                        country: p.country ? p.country.toLowerCase() : 'england',
                        avg: p.avgMin ? (p.avgMin + p.avgMax) / 2 : (p.avg || 85),
                        co: p.checkoutMin ? (p.checkoutMin + p.checkoutMax) / 2 : (p.co || 35),
                        tourCard: p.tourCard !== false,
                        money: p.money || 0,
                        form: p.form || 50,
                        fatigue: p.fatigue || 0
                    }));
                    console.log("[Career] Loaded " + PLAYERS_DB.length + " players from database");
                } else {
                    // Generate filler players for defaults
                    generateDefaultPlayers();
                    console.log("[Career] Using " + PLAYERS_DB.length + " default players");
                }

                // If we got tournaments from DB, convert to career format
                if (dbTournaments && dbTournaments.length > 0) {
                    // Prize money by event type (same as darts.html)
                    const PRIZE_MONEY = {
                        'q-school': 0,
                        'challenge': 10000,
                        'players': 75000,
                        'minor': 175000,
                        'masters': 60000,
                        'winmaudm': 300000,
                        'wmasters-qual': 10000,
                        'premier-league': 50000,
                        'premier-league-playoff': 250000,
                        'uk-open': 500000,
                        'matchplay': 800000,
                        'grandprix': 600000,
                        'european-championship': 500000,
                        'pc-finals': 500000,
                        'grand-slam': 650000,
                        'grandslam': 650000,
                        'ws-finals': 300000,
                        'world': 2500000,
                        'et-qual-tc': 10000,
                        'et-host-nation': 10000,
                        'et-east-european': 10000,
                        'et-nordic-baltic': 10000,
                        'wc-qual-intl': 15000,
                        'wc-qual-tc': 15000,
                        'gs-qual-tc': 10000,
                        'ws-qual-tc': 10000
                    };
                    
                    EVENTS_DB = dbTournaments.map((t, idx) => {
                        const eventType = t.type || 'players';
                        return {
                            id: t.id || idx + 1,
                            name: t.name,
                            date: t.date || `Week ${idx + 1}`,
                            type: eventType,
                            format: t.format || 'legs',
                            players: t.players || 128,
                            prize: t.prize || PRIZE_MONEY[eventType] || 75000,
                            cardRequired: t.cardRequired === true,
                            location: t.location || null,
                            eligibleRegions: t.eligibleRegions || [],
                            region: t.region || null,
                            targetEvent: t.targetEvent || null,
                            slots: t.slots || null,
                            night: t.night || null
                        };
                    });
                    console.log("[Career] Loaded " + EVENTS_DB.length + " tournaments from database");
                } else {
                    console.log("[Career] Using " + EVENTS_DB.length + " default tournaments");
                }

                // Initialize career UI
                Career.init();
                Career.updateStartingStats();
                
                // Initialize auth system (shared with main game)
                await AuthSystem.init();
                
                console.log("[Career] Initialization complete");
            } catch (e) {
                console.error("[Career] Init error:", e);
                // Still initialize with defaults on error
                generateDefaultPlayers();
                Career.init();
                Career.updateStartingStats();
            }
        });
    </script>

    <!-- ACCOUNT BUTTON (Fixed Position) -->
    <button onclick="AuthSystem.showModal()"
        style="position: fixed; bottom: 35px; right: 12px; z-index: 9998; background: #0066cc; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">ğŸ‘¤
        ACCOUNT</button>

    <!-- VERSION FOOTER -->
    <div id="version-footer"
        style="position: fixed; bottom: 8px; right: 12px; font-size: 12px; color: #aaa; font-family: Arial, sans-serif; z-index: 9999; pointer-events: none; background: rgba(0,0,0,0.5); padding: 4px 8px; border-radius: 4px;">
        v1.0 | PDC Career Mode
    </div>
</body>
</html>
