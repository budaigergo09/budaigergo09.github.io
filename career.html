<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PDC Career Mode 2026</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&family=Roboto+Condensed:wght@400;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="icon.png">
    
    <style>
        :root {
            --pdc-red: #d50000;
            --pdc-dark-red: #9a0000;
            --pdc-blue: #0e2a3a;
            --pdc-bg: #0a0e1a;
            --pdc-gold: #ffd700;
            --text-grey: #8fa3ad;
            --pdc-green: #00b359;
            --card-bg: linear-gradient(145deg, #1a1f35, #0f1525);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #0a0e1a 0%, #1a1f35 50%, #0a0e1a 100%);
            background-attachment: fixed;
            color: white;
            font-family: 'Roboto', sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: linear-gradient(180deg, var(--pdc-gold), #cc9900); border-radius: 10px; }

        /* Header */
        .header {
            background: linear-gradient(180deg, rgba(12, 16, 28, 0.95), rgba(8, 11, 20, 0.9));
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--pdc-gold);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            font-size: 20px;
            color: var(--pdc-gold);
            font-family: 'Roboto Condensed', sans-serif;
        }

        .header-buttons {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
            font-family: 'Roboto Condensed', sans-serif;
            transition: all 0.3s;
        }

        .btn-gold {
            background: linear-gradient(135deg, var(--pdc-gold), #cc9900);
            color: black;
        }

        .btn-gold:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
        }

        .btn-secondary {
            background: #333;
            color: white;
            border: 1px solid #555;
        }

        .btn-secondary:hover {
            background: #444;
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        /* Screens */
        .screen {
            display: none;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }

        .screen.active {
            display: block;
        }

        /* Main Menu */
        #main-menu {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: calc(100vh - 80px);
            text-align: center;
        }

        .menu-title {
            font-size: 48px;
            font-weight: 900;
            color: var(--pdc-gold);
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
            margin-bottom: 10px;
        }

        .menu-subtitle {
            color: #888;
            font-size: 18px;
            margin-bottom: 40px;
        }

        .menu-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
            max-width: 300px;
        }

        .menu-btn {
            padding: 18px 30px;
            font-size: 18px;
            border-radius: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Character Creation */
        .creation-section {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 215, 0, 0.1);
        }

        .creation-section h2 {
            color: var(--pdc-gold);
            font-size: 18px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 215, 0, 0.2);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: #aaa;
            font-size: 12px;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            background: #0a0e1a;
            border: 1px solid #333;
            border-radius: 6px;
            color: white;
            font-size: 16px;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--pdc-gold);
        }

        .player-type-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
        }

        .type-btn {
            flex: 1;
            padding: 15px;
            background: #1a1f35;
            border: 2px solid #333;
            border-radius: 8px;
            color: #888;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .type-btn.active {
            border-color: var(--pdc-gold);
            color: var(--pdc-gold);
            background: rgba(255, 215, 0, 0.1);
        }

        .type-btn:hover {
            border-color: #555;
        }

        /* Stats Display */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .stat-box {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-box .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: var(--pdc-gold);
        }

        .stat-box .stat-label {
            font-size: 11px;
            color: #888;
            text-transform: uppercase;
            margin-top: 5px;
        }

        /* Player Card */
        .player-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 215, 0, 0.2);
        }

        .player-flag {
            width: 60px;
            height: 40px;
            border-radius: 4px;
            object-fit: cover;
        }

        .player-info h3 {
            font-size: 20px;
            color: white;
            margin-bottom: 5px;
        }

        .player-info p {
            color: #888;
            font-size: 14px;
        }

        .player-stats-bar {
            display: flex;
            gap: 20px;
            margin-left: auto;
        }

        .player-stat {
            text-align: center;
        }

        .player-stat .value {
            font-size: 18px;
            font-weight: bold;
            color: var(--pdc-gold);
        }

        .player-stat .label {
            font-size: 10px;
            color: #666;
            text-transform: uppercase;
        }

        /* Career Dashboard */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 600px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }

        .dashboard-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 215, 0, 0.1);
        }

        .dashboard-card h3 {
            color: var(--pdc-gold);
            font-size: 14px;
            text-transform: uppercase;
            margin-bottom: 15px;
        }

        /* Progress Bars */
        .progress-bar {
            background: #1a1f35;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .progress-fill.fatigue {
            background: linear-gradient(90deg, #e74c3c, #c0392b);
        }

        .progress-fill.form {
            background: linear-gradient(90deg, var(--pdc-green), #009944);
        }

        /* Event List */
        .event-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .event-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid transparent;
        }

        .event-item:hover {
            background: rgba(255, 215, 0, 0.05);
            border-color: rgba(255, 215, 0, 0.2);
        }

        .event-item.completed {
            opacity: 0.5;
        }

        .event-item.current {
            border-color: var(--pdc-gold);
            background: rgba(255, 215, 0, 0.1);
        }

        .event-item.ineligible {
            opacity: 0.4;
        }

        .event-date {
            width: 60px;
            text-align: center;
            font-size: 12px;
            color: #888;
        }

        .event-name {
            flex: 1;
            font-weight: bold;
            margin-left: 15px;
        }

        .event-status {
            font-size: 11px;
            padding: 4px 10px;
            border-radius: 4px;
            text-transform: uppercase;
        }

        .event-status.eligible {
            background: rgba(0, 179, 89, 0.2);
            color: var(--pdc-green);
        }

        .event-status.ineligible {
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
        }

        /* Free Time Actions */
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .action-btn {
            flex: 1;
            padding: 20px;
            background: var(--card-bg);
            border: 2px solid #333;
            border-radius: 12px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .action-btn:hover {
            border-color: var(--pdc-gold);
            transform: translateY(-2px);
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .action-btn .icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .action-btn .title {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 5px;
        }

        .action-btn .desc {
            font-size: 12px;
            color: #888;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.85);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-box {
            background: var(--card-bg);
            border: 2px solid var(--pdc-gold);
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-title {
            font-size: 20px;
            color: var(--pdc-gold);
            margin-bottom: 20px;
            text-align: center;
        }

        /* Standings Table */
        .standings-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        .standings-table th {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            text-align: left;
            color: #888;
            font-size: 11px;
            text-transform: uppercase;
        }

        .standings-table td {
            padding: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .standings-table tr.highlight {
            background: rgba(255, 215, 0, 0.1);
        }

        .standings-table tr.highlight td {
            color: var(--pdc-gold);
            font-weight: bold;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.3);
            padding: 5px;
            border-radius: 8px;
        }

        .tab-btn {
            flex: 1;
            padding: 10px;
            background: transparent;
            border: none;
            color: #888;
            cursor: pointer;
            border-radius: 6px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .tab-btn.active {
            background: var(--pdc-gold);
            color: black;
        }

        /* Existing Player Select */
        .player-select-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .player-select-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 6px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }

        .player-select-item:hover {
            background: rgba(255, 215, 0, 0.1);
        }

        .player-select-item.selected {
            border-color: var(--pdc-gold);
            background: rgba(255, 215, 0, 0.15);
        }

        .player-select-item img {
            width: 30px;
            height: 20px;
            margin-right: 12px;
            border-radius: 2px;
        }

        .player-select-item .name {
            flex: 1;
        }

        .player-select-item .avg {
            color: var(--pdc-gold);
            font-weight: bold;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--card-bg);
            border: 2px solid var(--pdc-gold);
            padding: 15px 30px;
            border-radius: 8px;
            z-index: 1001;
            display: none;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { top: 50px; opacity: 0; }
            to { top: 80px; opacity: 1; }
        }

        /* Search */
        .search-box {
            margin-bottom: 15px;
        }

        .search-box input {
            width: 100%;
            padding: 12px;
            background: #0a0e1a;
            border: 1px solid #333;
            border-radius: 6px;
            color: white;
            font-size: 14px;
        }

        /* Tournament Entry */
        .tournament-info {
            text-align: center;
            padding: 20px 0;
        }

        .tournament-info h2 {
            color: var(--pdc-gold);
            font-size: 24px;
            margin-bottom: 10px;
        }

        .tournament-info p {
            color: #888;
            margin-bottom: 5px;
        }

        .tournament-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
        }

        /* Week Display */
        .week-display {
            text-align: center;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .week-display .week {
            font-size: 14px;
            color: #888;
        }

        .week-display .date {
            font-size: 20px;
            color: var(--pdc-gold);
            font-weight: bold;
        }

        /* ==================== TOURNAMENT BRACKET STYLES ==================== */
        #tournament-screen {
            display: none;
            flex-direction: column;
            height: calc(100vh - 60px);
            max-width: 100%;
            padding: 0;
        }

        .tournament-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: linear-gradient(180deg, rgba(26, 31, 53, 0.95), rgba(15, 21, 37, 0.9));
            padding: 15px 20px;
            border-bottom: 2px solid rgba(255, 215, 0, 0.2);
            flex-shrink: 0;
        }

        .tournament-header h2 {
            font-size: 20px;
            color: var(--pdc-gold);
        }

        .tournament-header .actions {
            display: flex;
            gap: 10px;
        }

        .bracket-wrapper {
            display: flex;
            flex: 1;
            overflow-x: auto;
            overflow-y: auto;
            padding: 30px 20px;
            position: relative;
            -webkit-overflow-scrolling: touch;
            gap: 60px;
        }

        .bracket-round-column {
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-width: 300px;
            flex-shrink: 0;
        }

        .round-column-header {
            text-align: center;
            padding: 10px;
            background: linear-gradient(145deg, rgba(26, 31, 53, 0.6), rgba(15, 21, 37, 0.6));
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 215, 0, 0.2);
        }

        .round-column-name {
            font-size: 16px;
            font-weight: bold;
            color: var(--pdc-gold);
            text-transform: uppercase;
        }

        .round-column-format {
            font-size: 11px;
            color: #8fa3ad;
        }

        .bracket-matches-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .bracket-match-wrapper {
            position: relative;
        }

        .bracket-match {
            background: linear-gradient(145deg, #1a1f35, #12172a);
            border: 2px solid rgba(255, 215, 0, 0.2);
            border-left: 4px solid rgba(255, 215, 0, 0.4);
            padding: 10px 14px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            min-height: 58px;
        }

        .bracket-match:hover {
            background: linear-gradient(145deg, #1f2540, #161b30);
            transform: scale(1.02);
            border-color: rgba(255, 215, 0, 0.3);
        }

        .bracket-match.completed {
            border-left-color: var(--pdc-gold);
            border-color: rgba(255, 215, 0, 0.3);
        }

        .bracket-match.player-match {
            border-color: var(--pdc-green);
            border-left-color: var(--pdc-green);
            box-shadow: 0 0 15px rgba(0, 179, 89, 0.3);
        }

        .bm-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .bm-row {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .bm-flag {
            width: 20px;
            height: 14px;
            border-radius: 2px;
            object-fit: cover;
        }

        .bm-name {
            flex: 1;
            font-size: 13px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .bm-score {
            font-size: 16px;
            font-weight: bold;
            min-width: 20px;
            text-align: center;
        }

        .bm-avg {
            font-size: 10px;
            color: #888;
        }

        .btn-play-match {
            background: linear-gradient(135deg, var(--pdc-green), #009944);
            color: white;
            border: none;
            padding: 8px 14px;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            font-size: 11px;
        }

        .btn-play-match:hover {
            transform: scale(1.05);
        }

        .btn-sim-match {
            background: linear-gradient(135deg, #666, #444);
            color: white;
            border: none;
            padding: 8px 14px;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            font-size: 11px;
        }

        /* Match Screen */
        #match-screen {
            display: none;
            flex-direction: column;
            height: calc(100vh - 60px);
            background: linear-gradient(135deg, #0a0e1a 0%, #1a1f35 50%, #0a0e1a 100%);
        }

        .match-header {
            text-align: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
        }

        .match-header h2 {
            color: var(--pdc-gold);
            font-size: 18px;
        }

        .match-header .round-info {
            color: #888;
            font-size: 14px;
        }

        .scoreboard {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 30px 20px;
            gap: 30px;
        }

        .player-box {
            text-align: center;
            flex: 1;
            max-width: 200px;
        }

        .player-box img {
            width: 60px;
            height: 40px;
            border-radius: 4px;
            margin-bottom: 10px;
        }

        .player-box .name {
            font-size: 16px;
            font-weight: bold;
            color: white;
            margin-bottom: 5px;
        }

        .player-box .score {
            font-size: 48px;
            font-weight: 900;
            color: var(--pdc-gold);
        }

        .player-box .remaining {
            font-size: 36px;
            color: white;
            margin-top: 10px;
        }

        .player-box.active {
            transform: scale(1.05);
        }

        .player-box.active .name {
            color: var(--pdc-gold);
        }

        .vs-divider {
            font-size: 24px;
            color: #555;
            font-weight: bold;
        }

        .leg-info {
            text-align: center;
            padding: 10px;
            color: #888;
            font-size: 14px;
        }

        .dart-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            padding: 20px;
            max-width: 400px;
            margin: 0 auto;
        }

        .dart-btn {
            padding: 15px;
            background: #1a1f35;
            border: 2px solid #333;
            border-radius: 8px;
            color: white;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
        }

        .dart-btn:hover {
            border-color: var(--pdc-gold);
            background: rgba(255, 215, 0, 0.1);
        }

        .dart-btn.checkout {
            background: rgba(0, 179, 89, 0.2);
            border-color: var(--pdc-green);
        }

        /* Match Result Modal */
        .match-result-modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 200;
        }

        .match-result-content {
            background: linear-gradient(145deg, #1a1f35, #0f1525);
            border: 2px solid var(--pdc-gold);
            border-radius: 16px;
            padding: 40px;
            text-align: center;
            max-width: 500px;
            width: 90%;
        }

        .match-result-content h2 {
            color: var(--pdc-gold);
            font-size: 28px;
            margin-bottom: 20px;
        }

        .match-result-content .winner-name {
            font-size: 24px;
            font-weight: bold;
            color: white;
            margin-bottom: 10px;
        }

        .match-result-content .final-score {
            font-size: 36px;
            color: var(--pdc-gold);
            font-weight: 900;
            margin-bottom: 20px;
        }

        .match-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }

        .match-stats .stat {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
        }

        .match-stats .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--pdc-gold);
        }

        .match-stats .stat-label {
            font-size: 11px;
            color: #888;
            text-transform: uppercase;
        }

        @media (max-width: 768px) {
            .bracket-wrapper {
                padding: 15px 10px;
                gap: 40px;
            }
            .bracket-round-column {
                min-width: 260px;
            }
            .bracket-match {
                min-height: 50px;
                padding: 8px 10px;
            }
        }
    </style>
</head>

<body>
    <div class="header">
        <h1>üéØ PDC CAREER MODE</h1>
        <div class="header-buttons">
            <button class="btn btn-secondary" onclick="Career.saveGame()">üíæ SAVE</button>
            <button class="btn btn-gold" onclick="AuthSystem.showModal()" style="background:#0066cc;">üë§ ACCOUNT</button>
            <button class="btn btn-secondary" onclick="location.href='darts.html'">üè† MAIN</button>
        </div>
    </div>

    <!-- Main Menu Screen -->
    <div id="main-menu" class="screen active">
        <div class="menu-title">CAREER MODE</div>
        <div class="menu-subtitle">Write your own darts legacy</div>
        <div class="menu-buttons">
            <button class="btn btn-gold menu-btn" onclick="Career.showNewCareer()">üÜï NEW CAREER</button>
            <button class="btn btn-secondary menu-btn" onclick="Career.loadGame()">üìÇ LOAD CAREER</button>
            <button class="btn btn-secondary menu-btn" onclick="location.href='darts.html'">‚Ü©Ô∏è BACK TO MAIN</button>
        </div>
    </div>

    <!-- Character Creation Screen -->
    <div id="create-screen" class="screen">
        <h2 style="color: var(--pdc-gold); margin-bottom: 20px;">CREATE YOUR CAREER</h2>
        
        <div class="player-type-toggle">
            <div class="type-btn active" id="type-custom" onclick="Career.setPlayerType('custom')">
                <div style="font-size: 24px; margin-bottom: 5px;">‚ú®</div>
                <div>Create Custom Player</div>
            </div>
            <div class="type-btn" id="type-existing" onclick="Career.setPlayerType('existing')">
                <div style="font-size: 24px; margin-bottom: 5px;">üë§</div>
                <div>Play as Existing Player</div>
            </div>
        </div>

        <!-- Custom Player Form -->
        <div id="custom-form" class="creation-section">
            <h2>Player Details</h2>
            <div class="form-group">
                <label>Player Name</label>
                <input type="text" id="player-name" placeholder="Enter your name" maxlength="30">
            </div>
            <div class="form-group">
                <label>Nationality</label>
                <select id="player-country">
                    <option value="england">üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø England</option>
                    <option value="scotland">üè¥Û†ÅßÛ†Å¢Û†Å≥Û†Å£Û†Å¥Û†Åø Scotland</option>
                    <option value="wales">üè¥Û†ÅßÛ†Å¢Û†Å∑Û†Å¨Û†Å≥Û†Åø Wales</option>
                    <option value="netherlands">üá≥üá± Netherlands</option>
                    <option value="belgium">üáßüá™ Belgium</option>
                    <option value="germany">üá©üá™ Germany</option>
                    <option value="austria">üá¶üáπ Austria</option>
                    <option value="australia">üá¶üá∫ Australia</option>
                    <option value="usa">üá∫üá∏ United States</option>
                    <option value="canada">üá®üá¶ Canada</option>
                    <option value="ireland">üáÆüá™ Ireland</option>
                    <option value="northern ireland">üá¨üáß Northern Ireland</option>
                    <option value="poland">üáµüá± Poland</option>
                    <option value="czech republic">üá®üáø Czech Republic</option>
                    <option value="hungary">üá≠üá∫ Hungary</option>
                    <option value="portugal">üáµüáπ Portugal</option>
                    <option value="spain">üá™üá∏ Spain</option>
                    <option value="france">üá´üá∑ France</option>
                    <option value="japan">üáØüáµ Japan</option>
                    <option value="philippines">üáµüá≠ Philippines</option>
                    <option value="china">üá®üá≥ China</option>
                    <option value="south africa">üáøüá¶ South Africa</option>
                    <option value="new zealand">üá≥üáø New Zealand</option>
                    <option value="sweden">üá∏üá™ Sweden</option>
                    <option value="denmark">üá©üá∞ Denmark</option>
                    <option value="norway">üá≥üá¥ Norway</option>
                    <option value="finland">üá´üáÆ Finland</option>
                    <option value="lithuania">üá±üáπ Lithuania</option>
                    <option value="latvia">üá±üáª Latvia</option>
                    <option value="greece">üá¨üá∑ Greece</option>
                    <option value="italy">üáÆüáπ Italy</option>
                    <option value="croatia">üá≠üá∑ Croatia</option>
                    <option value="slovakia">üá∏üá∞ Slovakia</option>
                    <option value="singapore">üá∏üá¨ Singapore</option>
                    <option value="hong kong">üá≠üá∞ Hong Kong</option>
                    <option value="brazil">üáßüá∑ Brazil</option>
                </select>
            </div>
            <div class="form-group">
                <label>Starting Level</label>
                <select id="player-level" onchange="Career.updateStartingStats()">
                    <option value="amateur">Amateur (Avg: 65-70)</option>
                    <option value="semi-pro">Semi-Pro (Avg: 75-80)</option>
                    <option value="professional">Professional (Avg: 85-88)</option>
                </select>
            </div>
            
            <h2 style="margin-top: 25px;">Starting Stats</h2>
            <div class="stats-grid" id="starting-stats">
                <div class="stat-box">
                    <div class="stat-value" id="stat-avg">67.5</div>
                    <div class="stat-label">Average</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="stat-co">32%</div>
                    <div class="stat-label">Checkout %</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="stat-form">50</div>
                    <div class="stat-label">Form</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="stat-fatigue">0</div>
                    <div class="stat-label">Fatigue</div>
                </div>
            </div>
        </div>

        <!-- Existing Player Selection -->
        <div id="existing-form" class="creation-section" style="display: none;">
            <h2>Select Player</h2>
            <div class="search-box">
                <input type="text" id="player-search" placeholder="Search players..." oninput="Career.filterPlayers()">
            </div>
            <div class="player-select-list" id="player-list"></div>
        </div>

        <div style="display: flex; gap: 15px; margin-top: 20px;">
            <button class="btn btn-secondary" style="flex: 1;" onclick="Career.showMainMenu()">‚Üê BACK</button>
            <button class="btn btn-gold" style="flex: 2;" onclick="Career.startCareer()">START CAREER ‚Üí</button>
        </div>
    </div>

    <!-- Career Dashboard Screen -->
    <div id="dashboard-screen" class="screen">
        <!-- Player Card -->
        <div class="player-card" id="dashboard-player-card">
            <img class="player-flag" id="dash-flag" src="" alt="">
            <div class="player-info">
                <h3 id="dash-name">Player Name</h3>
                <p id="dash-rank">World Rank: #128</p>
            </div>
            <div class="player-stats-bar">
                <div class="player-stat">
                    <div class="value" id="dash-avg">85.0</div>
                    <div class="label">Average</div>
                </div>
                <div class="player-stat">
                    <div class="value" id="dash-co">38%</div>
                    <div class="label">Checkout</div>
                </div>
                <div class="player-stat">
                    <div class="value" id="dash-money">¬£0</div>
                    <div class="label">Earnings</div>
                </div>
            </div>
        </div>

        <!-- Week Display -->
        <div class="week-display">
            <div class="week">Week <span id="current-week">1</span> of 52</div>
            <div class="date" id="current-date">January 2026</div>
        </div>

        <!-- Status Bars -->
        <div class="dashboard-grid">
            <div class="dashboard-card">
                <h3>‚ö° Fatigue</h3>
                <div class="progress-bar">
                    <div class="progress-fill fatigue" id="fatigue-bar" style="width: 0%;"></div>
                </div>
                <div style="text-align: right; font-size: 12px; color: #888;"><span id="fatigue-value">0</span>/100</div>
            </div>
            <div class="dashboard-card">
                <h3>üî• Form</h3>
                <div class="progress-bar">
                    <div class="progress-fill form" id="form-bar" style="width: 50%;"></div>
                </div>
                <div style="text-align: right; font-size: 12px; color: #888;"><span id="form-value">50</span>/100</div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-btn active" onclick="Career.switchTab('schedule')">üìÖ Schedule</button>
            <button class="tab-btn" onclick="Career.switchTab('standings')">üèÜ Standings</button>
            <button class="tab-btn" onclick="Career.switchTab('stats')">üìä Stats</button>
        </div>

        <!-- Schedule Tab -->
        <div id="tab-schedule" class="tab-content">
            <div class="event-list" id="event-list"></div>
        </div>

        <!-- Standings Tab -->
        <div id="tab-standings" class="tab-content" style="display: none;">
            <div class="tabs" style="margin-bottom: 15px;">
                <button class="tab-btn active" onclick="Career.switchStandings('oom')">Order of Merit</button>
                <button class="tab-btn" onclick="Career.switchStandings('protour')">Pro Tour</button>
            </div>
            <div id="standings-content"></div>
        </div>

        <!-- Stats Tab -->
        <div id="tab-stats" class="tab-content" style="display: none;">
            <div class="creation-section">
                <h2>Career Statistics</h2>
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value" id="stats-played">0</div>
                        <div class="stat-label">Events Played</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="stats-wins">0</div>
                        <div class="stat-label">Titles Won</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="stats-finals">0</div>
                        <div class="stat-label">Finals</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="stats-semis">0</div>
                        <div class="stat-label">Semi-Finals</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="stats-180s">0</div>
                        <div class="stat-label">180s</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="stats-highco">0</div>
                        <div class="stat-label">Highest Checkout</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons" id="action-buttons">
            <button class="action-btn" onclick="Career.rest()" id="btn-rest">
                <div class="icon">üò¥</div>
                <div class="title">REST</div>
                <div class="desc">-20 Fatigue</div>
            </button>
            <button class="action-btn" onclick="Career.train()" id="btn-train">
                <div class="icon">üéØ</div>
                <div class="title">TRAIN</div>
                <div class="desc">+Stats, +10 Fatigue</div>
            </button>
            <button class="action-btn" onclick="Career.advanceWeek()" id="btn-advance">
                <div class="icon">‚è≠Ô∏è</div>
                <div class="title">NEXT WEEK</div>
                <div class="desc">Advance time</div>
            </button>
        </div>
    </div>

    <!-- Event Modal -->
    <div class="modal-overlay" id="event-modal">
        <div class="modal-box">
            <div class="tournament-info">
                <h2 id="modal-event-name">Tournament Name</h2>
                <p id="modal-event-date">Date</p>
                <p id="modal-event-type">Type</p>
                <p id="modal-event-players">Players: 128</p>
                <p id="modal-event-prize">Prize Pool: ¬£500,000</p>
            </div>
            
            <div id="modal-eligibility" style="text-align: center; margin: 20px 0; padding: 15px; border-radius: 8px;"></div>
            
            <div class="tournament-actions">
                <button class="btn btn-secondary" onclick="Career.closeEventModal()">CLOSE</button>
                <button class="btn btn-gold" id="btn-enter-event" onclick="Career.enterEvent()">ENTER EVENT</button>
            </div>
        </div>
    </div>

    <!-- Tournament Bracket Screen -->
    <div id="tournament-screen">
        <div class="tournament-header">
            <h2 id="tourn-title">Tournament Name</h2>
            <div class="actions">
                <button class="btn btn-secondary" onclick="CareerTournament.simCurrentRound()">‚è© SIM ROUND</button>
                <button class="btn btn-danger" onclick="CareerTournament.exitTournament()">‚ùå EXIT</button>
            </div>
        </div>
        <div class="bracket-wrapper" id="bracket-container"></div>
    </div>

    <!-- Match Screen -->
    <div id="match-screen">
        <div class="match-header">
            <h2 id="match-event-name">Event Name</h2>
            <div class="round-info" id="match-round-info">Round - First to X</div>
        </div>
        <div class="scoreboard">
            <div class="player-box" id="p1-box">
                <img id="p1-flag" src="" alt="">
                <div class="name" id="p1-name">Player 1</div>
                <div class="score" id="p1-legs">0</div>
                <div class="remaining" id="p1-remaining">501</div>
            </div>
            <div class="vs-divider">VS</div>
            <div class="player-box" id="p2-box">
                <img id="p2-flag" src="" alt="">
                <div class="name" id="p2-name">Player 2</div>
                <div class="score" id="p2-legs">0</div>
                <div class="remaining" id="p2-remaining">501</div>
            </div>
        </div>
        <div class="leg-info" id="leg-info">Leg 1 - Player 1 to throw</div>
        <div style="text-align: center; padding: 20px;">
            <button class="btn btn-gold" onclick="CareerMatch.throwDart()" id="btn-throw">üéØ THROW</button>
            <button class="btn btn-secondary" onclick="CareerMatch.simLeg()" style="margin-left: 10px;">‚è© SIM LEG</button>
            <button class="btn btn-secondary" onclick="CareerMatch.simMatch()" style="margin-left: 10px;">‚è≠Ô∏è SIM MATCH</button>
        </div>
        <div id="visit-log" style="text-align: center; padding: 10px; color: #888; max-height: 150px; overflow-y: auto;"></div>
    </div>

    <!-- Match Result Modal -->
    <div class="match-result-modal" id="match-result-modal">
        <div class="match-result-content">
            <h2>MATCH COMPLETE</h2>
            <div class="winner-name" id="result-winner">Winner Name</div>
            <div class="final-score" id="result-score">3 - 1</div>
            <div class="match-stats">
                <div class="stat">
                    <div class="stat-value" id="result-avg-1">95.5</div>
                    <div class="stat-label">P1 Average</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="result-avg-2">92.3</div>
                    <div class="stat-label">P2 Average</div>
                </div>
            </div>
            <button class="btn btn-gold" onclick="CareerMatch.closeResult()" style="width: 100%;">CONTINUE</button>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <!-- AUTH MODAL -->
    <div id="auth-modal"
        style="position:fixed; inset:0; background:rgba(0,0,0,0.85); z-index:10001; display:none; justify-content:center; align-items:center; padding:20px;">
        <div
            style="background:linear-gradient(145deg, #1a1f35, #0f1525); border:2px solid #ffd700; border-radius:12px; padding:25px; max-width:400px; width:100%; color:white;">
            <div style="font-size:18px; font-weight:bold; color:#ffd700; margin-bottom:15px; text-align:center;">üë§
                ACCOUNT</div>

            <!-- Login View (shown when not logged in) -->
            <div id="auth-login-view">
                <!-- Login Form -->
                <div id="auth-login-form">
                    <div style="margin-bottom:12px;">
                        <label style="font-size:11px; color:#aaa; display:block; margin-bottom:4px;">USERNAME</label>
                        <input type="text" id="login-username" placeholder="Enter username"
                            style="width:100%; padding:10px; background:#0a0e1a; border:1px solid #444; border-radius:4px; color:#fff; font-size:14px; box-sizing:border-box;">
                    </div>
                    <div style="margin-bottom:15px;">
                        <label style="font-size:11px; color:#aaa; display:block; margin-bottom:4px;">PASSWORD</label>
                        <input type="password" id="login-password" placeholder="Enter password"
                            style="width:100%; padding:10px; background:#0a0e1a; border:1px solid #444; border-radius:4px; color:#fff; font-size:14px; box-sizing:border-box;">
                    </div>
                    <button onclick="AuthSystem.login()"
                        style="width:100%; padding:12px; background:#0066cc; border:none; color:white; border-radius:4px; cursor:pointer; font-weight:bold; font-size:14px;">üîê
                        LOGIN</button>
                    <div style="text-align:center; margin-top:12px;">
                        <span style="color:#888; font-size:12px;">Don't have an account? </span>
                        <a href="#" onclick="AuthSystem.switchToRegister(); return false;"
                            style="color:#ffd700; font-size:12px;">Register</a>
                    </div>
                </div>

                <!-- Register Form -->
                <div id="auth-register-form" style="display:none;">
                    <div style="margin-bottom:12px;">
                        <label style="font-size:11px; color:#aaa; display:block; margin-bottom:4px;">USERNAME</label>
                        <input type="text" id="reg-username" placeholder="Choose username (min 3 chars)"
                            style="width:100%; padding:10px; background:#0a0e1a; border:1px solid #444; border-radius:4px; color:#fff; font-size:14px; box-sizing:border-box;">
                    </div>
                    <div style="margin-bottom:12px;">
                        <label style="font-size:11px; color:#aaa; display:block; margin-bottom:4px;">PASSWORD</label>
                        <input type="password" id="reg-password" placeholder="Choose password (min 6 chars)"
                            style="width:100%; padding:10px; background:#0a0e1a; border:1px solid #444; border-radius:4px; color:#fff; font-size:14px; box-sizing:border-box;">
                    </div>
                    <div style="margin-bottom:15px;">
                        <label style="font-size:11px; color:#aaa; display:block; margin-bottom:4px;">CONFIRM
                            PASSWORD</label>
                        <input type="password" id="reg-confirm-password" placeholder="Confirm password"
                            style="width:100%; padding:10px; background:#0a0e1a; border:1px solid #444; border-radius:4px; color:#fff; font-size:14px; box-sizing:border-box;">
                    </div>
                    <button onclick="AuthSystem.register()"
                        style="width:100%; padding:12px; background:#00b359; border:none; color:white; border-radius:4px; cursor:pointer; font-weight:bold; font-size:14px;">üìù
                        REGISTER</button>
                    <div style="text-align:center; margin-top:12px;">
                        <span style="color:#888; font-size:12px;">Already have an account? </span>
                        <a href="#" onclick="AuthSystem.switchToLogin(); return false;"
                            style="color:#ffd700; font-size:12px;">Login</a>
                    </div>
                </div>

                <div id="auth-error" style="color:#ff4444; font-size:12px; text-align:center; margin-top:10px;">
                </div>
            </div>

            <!-- Account View (shown when logged in) -->
            <div id="auth-account-view" style="display:none;">
                <div style="text-align:center; margin-bottom:20px;">
                    <div style="font-size:40px; margin-bottom:10px;">üë§</div>
                    <div style="font-size:16px; font-weight:bold; color:#fff;">Welcome, <span
                            id="auth-username-display"></span>!</div>
                    <div style="font-size:11px; color:#888; margin-top:5px;">Last sync: <span
                            id="auth-last-sync">Never</span></div>
                </div>

                <div style="display:flex; flex-direction:column; gap:10px; margin-bottom:20px;">
                    <button id="auth-save-btn" onclick="Career.saveToCloud()"
                        style="width:100%; padding:12px; background:#00b359; border:none; color:white; border-radius:4px; cursor:pointer; font-weight:bold;">üíæ
                        SAVE CAREER TO SERVER</button>
                    <button id="auth-load-btn" onclick="Career.loadFromCloud()"
                        style="width:100%; padding:12px; background:#0066cc; border:none; color:white; border-radius:4px; cursor:pointer; font-weight:bold;">üì•
                        LOAD CAREER FROM SERVER</button>
                </div>

                <div
                    style="padding:12px; background:rgba(0,102,0,0.2); border:1px solid #00b359; border-radius:6px; margin-bottom:15px;">
                    <div style="font-size:11px; color:#00b359;">‚úì Same account as main game</div>
                    <div style="font-size:11px; color:#888; margin-top:4px;">Career saves are stored separately from season saves
                    </div>
                </div>

                <button onclick="AuthSystem.logout()"
                    style="width:100%; padding:10px; background:#9a0000; border:none; color:white; border-radius:4px; cursor:pointer; font-weight:bold;">üö™
                    LOGOUT</button>
            </div>

            <button onclick="AuthSystem.closeModal()"
                style="width:100%; padding:10px; background:#444; border:none; color:white; border-radius:4px; cursor:pointer; font-weight:bold; margin-top:15px;">CLOSE</button>
        </div>
    </div>

    <!-- Load shared module (Engine, Logic, AuthSystem, DataLoader) -->
    <script src="shared.js"></script>

    <script>
        // ==================== ROUND FORMATS (from darts.html) ====================
        const ROUND_FORMATS = {
            'masters': { L16: 6, QF: 6, SF: 8, F: 8 },
            'major': { QF: 10, SF: 10, F: 11 },
            'minor': { L32: 6, L16: 6, QF: 6, SF: 7, F: 8 },
            'matchplay': { L32: 10, L16: 11, QF: 16, SF: 17, F: 18 },
            'masters-final': { L32: 6, L16: 6, QF: 10, SF: 11, F: 11 },
            'grandprix': { L32: 2, L16: 3, QF: 3, SF: 5, F: 6 },
            'european-championship': { L32: 6, L16: 6, QF: 10, SF: 11, F: 11 },
            'europeanf': { L32: 6, L16: 6, QF: 10, SF: 11, F: 11 },
            'players': { L128: 6, L64: 6, L32: 6, L16: 6, QF: 6, SF: 7, F: 8 },
            'challenge': { L128: 5, L64: 5, L32: 5, L16: 5, QF: 5, SF: 6, F: 6 },
            'grandslam': { Group: 5, L16: 10, QF: 16, SF: 16, F: 16 },
            'grand-slam': { Group: 5, L16: 10, QF: 16, SF: 16, F: 16 },
            'playersf': { L64: 6, L32: 6, L16: 10, QF: 10, SF: 11, F: 11 },
            'pc-finals': { L64: 6, L32: 6, L16: 10, QF: 10, SF: 11, F: 11 },
            'q-school': { L256: 5, L128: 5, L64: 5, L32: 5, L16: 5, QF: 5, SF: 6, F: 6 },
            'world': { L128: 3, L64: 3, L32: 4, L16: 4, QF: 5, SF: 6, F: 7 },
            'uk-open': { L128: 6, L64: 6, L32: 6, L16: 10, QF: 10, SF: 11, F: 11 },
            'et-qual-tc': { L64: 6, L32: 6, L16: 6, QF: 6, SF: 7, F: 8 },
            'et-host-nation': { QF: 6, SF: 7, F: 8 },
            'et-east-european': { L16: 6, QF: 6, SF: 7, F: 8 },
            'et-nordic-baltic': { L16: 6, QF: 6, SF: 7, F: 8 },
            'ws-qual-tc': { L64: 6, L32: 6, L16: 6, QF: 6, SF: 7, F: 8 },
            'gs-qual-tc': { L64: 6, L32: 6, L16: 6, QF: 6, SF: 7, F: 8 },
            'wmasters-qual': { L64: 6, L32: 6, L16: 6, QF: 6, SF: 7, F: 8 },
            'winmaudm': { L32: 6, L16: 6, QF: 6, SF: 7, F: 8 },
            'premier-league': { L16: 6, QF: 6, SF: 8, F: 10 },
            'ws-finals': { L32: 6, L16: 6, QF: 6, SF: 7, F: 8 }
        };

        // ==================== PRIZE STRUCTURE (from darts.html) ====================
        const PRIZE_STRUCTURE = {
            'masters': { 16: 1000, 8: 3000, 4: 5000, 2: 8000, 1: 12000 },
            'masters-final': { 32: 5000, 16: 10000, 8: 17500, 4: 30000, 2: 60000, 1: 100000 },
            'q-school': { 256: 0, 128: 0, 64: 0, 32: 0, 16: 0, 8: 0, 4: 0, 2: 0, 1: 0 },
            'minor': { 32: 2500, 16: 4000, 8: 6000, 4: 8500, 2: 12000, 1: 30000 },
            'major': { 128: 0, 64: 2500, 32: 5000, 16: 10000, 8: 20000, 4: 40000, 2: 80000, 1: 150000 },
            'world': { 128: 15000, 64: 25000, 32: 35000, 16: 60000, 8: 100000, 4: 200000, 2: 400000, 1: 1000000 },
            'players': { 128: 0, 64: 1000, 32: 2000, 16: 3000, 8: 5000, 4: 7500, 2: 10000, 1: 15000 },
            'challenge': { 128: 0, 64: 100, 32: 250, 16: 350, 8: 750, 4: 1000, 2: 2000, 1: 3000 },
            'uk-open': { 160: 0, 128: 1000, 96: 1500, 64: 2500, 32: 5000, 16: 10000, 8: 15000, 4: 30000, 2: 50000, 1: 110000 },
            'et-qual-tc': { 64: 0, 32: 0, 16: 0, 8: 0, 4: 0, 2: 0, 1: 0 },
            'et-host-nation': { 8: 0, 4: 0, 2: 0, 1: 0 },
            'et-east-european': { 16: 0, 8: 0, 4: 0, 2: 0, 1: 0 },
            'et-nordic-baltic': { 16: 0, 8: 0, 4: 0, 2: 0, 1: 0 },
            'ws-qual-tc': { 64: 0, 32: 0, 16: 0, 8: 0, 4: 0, 2: 0, 1: 0 },
            'gs-qual-tc': { 64: 0, 32: 0, 16: 0, 8: 0, 4: 0, 2: 0, 1: 0 },
            'wmasters-qual': { 64: 0, 32: 0, 16: 0, 8: 0, 4: 0, 2: 0, 1: 0 },
            'winmaudm': { 32: 5000, 16: 10000, 8: 17500, 4: 30000, 2: 50000, 1: 100000 },
            'matchplay': { 32: 10000, 16: 15000, 8: 30000, 4: 50000, 2: 100000, 1: 200000 },
            'european-championship': { 32: 7500, 16: 15000, 8: 25000, 4: 40000, 2: 60000, 1: 120000 },
            'europeanf': { 32: 7500, 16: 15000, 8: 25000, 4: 40000, 2: 60000, 1: 120000 },
            'grandprix': { 32: 7500, 16: 15000, 8: 25000, 4: 40000, 2: 60000, 1: 120000 },
            'pc-finals': { 64: 3000, 32: 6500, 16: 10000, 8: 20000, 4: 30000, 2: 60000, 1: 120000 },
            'playersf': { 64: 3000, 32: 6500, 16: 10000, 8: 20000, 4: 30000, 2: 60000, 1: 120000 },
            'grandslam': { 32: 5000, 16: 12250, 8: 25000, 4: 50000, 2: 70000, 1: 150000 },
            'grand-slam': { 32: 5000, 16: 12250, 8: 25000, 4: 50000, 2: 70000, 1: 150000 },
            'premier-league': { 16: 5000, 8: 10000, 4: 25000, 2: 50000, 1: 100000 },
            'ws-finals': { 32: 5000, 16: 10000, 8: 15000, 4: 25000, 2: 50000, 1: 100000 }
        };

        // Helper to get round name from player count
        function getRoundName(playersInRound) {
            return { 256: "L256", 128: "L128", 64: "L64", 32: "L32", 16: "L16", 8: "QF", 4: "SF", 2: "F" }[playersInRound] || "R" + playersInRound;
        }

        // ==================== PLAYER DATABASE ====================
        // This will be populated from database or use defaults
        let PLAYERS_DB = [
            { name: "Luke Humphries", country: "england", avg: 98.5, co: 42, tourCard: true, money: 850000 },
            { name: "Luke Littler", country: "england", avg: 99.2, co: 44, tourCard: true, money: 780000 },
            { name: "Michael van Gerwen", country: "netherlands", avg: 97.8, co: 43, tourCard: true, money: 720000 },
            { name: "Gary Anderson", country: "scotland", avg: 96.5, co: 41, tourCard: true, money: 450000 },
            { name: "Gerwyn Price", country: "wales", avg: 95.8, co: 40, tourCard: true, money: 520000 },
            { name: "Rob Cross", country: "england", avg: 95.2, co: 39, tourCard: true, money: 480000 },
            { name: "Michael Smith", country: "england", avg: 96.0, co: 41, tourCard: true, money: 510000 },
            { name: "Peter Wright", country: "scotland", avg: 94.5, co: 38, tourCard: true, money: 380000 },
            { name: "Jonny Clayton", country: "wales", avg: 95.0, co: 40, tourCard: true, money: 420000 },
            { name: "Dave Chisnall", country: "england", avg: 94.8, co: 39, tourCard: true, money: 350000 },
            { name: "Nathan Aspinall", country: "england", avg: 94.2, co: 38, tourCard: true, money: 320000 },
            { name: "Damon Heta", country: "australia", avg: 93.8, co: 38, tourCard: true, money: 290000 },
            { name: "Danny Noppert", country: "netherlands", avg: 93.5, co: 39, tourCard: true, money: 280000 },
            { name: "Chris Dobey", country: "england", avg: 93.2, co: 37, tourCard: true, money: 260000 },
            { name: "Stephen Bunting", country: "england", avg: 93.0, co: 38, tourCard: true, money: 250000 },
            { name: "Dimitri Van den Bergh", country: "belgium", avg: 92.8, co: 37, tourCard: true, money: 240000 },
            { name: "Joe Cullen", country: "england", avg: 92.5, co: 36, tourCard: true, money: 220000 },
            { name: "Josh Rock", country: "northern ireland", avg: 93.5, co: 39, tourCard: true, money: 210000 },
            { name: "Martin Schindler", country: "germany", avg: 92.0, co: 36, tourCard: true, money: 180000 },
            { name: "Dirk van Duijvenbode", country: "netherlands", avg: 91.8, co: 35, tourCard: true, money: 170000 },
            { name: "Ryan Searle", country: "england", avg: 91.5, co: 36, tourCard: true, money: 160000 },
            { name: "James Wade", country: "england", avg: 91.2, co: 37, tourCard: true, money: 200000 },
            { name: "Ross Smith", country: "england", avg: 91.0, co: 35, tourCard: true, money: 150000 },
            { name: "Andrew Gilding", country: "england", avg: 90.8, co: 35, tourCard: true, money: 140000 },
            { name: "Krzysztof Ratajski", country: "poland", avg: 90.5, co: 34, tourCard: true, money: 130000 },
            { name: "Raymond van Barneveld", country: "netherlands", avg: 90.2, co: 36, tourCard: true, money: 180000 },
            { name: "Ricardo Pietreczko", country: "germany", avg: 90.0, co: 34, tourCard: true, money: 120000 },
            { name: "Brendan Dolan", country: "northern ireland", avg: 89.8, co: 35, tourCard: true, money: 115000 },
            { name: "Mensur Suljovic", country: "austria", avg: 89.5, co: 36, tourCard: true, money: 140000 },
            { name: "Kim Huybrechts", country: "belgium", avg: 89.2, co: 34, tourCard: true, money: 105000 },
        ];

        // Generate more players to fill the tour (only if not loaded from DB)
        function generateDefaultPlayers() {
            for (let i = 31; i <= 128; i++) {
                const countries = ['england', 'netherlands', 'scotland', 'wales', 'germany', 'belgium', 'australia', 'austria', 'poland', 'ireland'];
                PLAYERS_DB.push({
                    name: `Player ${i}`,
                    country: countries[Math.floor(Math.random() * countries.length)],
                    avg: 85 + Math.random() * 8,
                    co: 30 + Math.random() * 8,
                    tourCard: true,
                    money: Math.floor(50000 + Math.random() * 100000)
                });
            }
        }

        // ==================== EVENTS DATABASE ====================
        // Default events - will be replaced if loaded from database
        let EVENTS_DB = [
            { id: 1, name: "Bahrain Darts Masters", date: "Jan 09", type: "world-series", players: 8, prize: 60000, cardRequired: false, invitational: true },
            { id: 2, name: "Players Championship 1", date: "Jan 25", type: "players", players: 128, prize: 75000, cardRequired: true },
            { id: 3, name: "Players Championship 2", date: "Jan 26", type: "players", players: 128, prize: 75000, cardRequired: true },
            { id: 4, name: "UK Open Qualifier 1", date: "Feb 01", type: "qualifier", players: 128, prize: 10000, cardRequired: true },
            { id: 5, name: "Players Championship 3", date: "Feb 07", type: "players", players: 128, prize: 75000, cardRequired: true },
            { id: 6, name: "Players Championship 4", date: "Feb 08", type: "players", players: 128, prize: 75000, cardRequired: true },
            { id: 7, name: "UK Open", date: "Feb 28", type: "major", players: 128, prize: 500000, cardRequired: false, qualifierRequired: true },
            { id: 8, name: "Players Championship 5", date: "Mar 07", type: "players", players: 128, prize: 75000, cardRequired: true },
            { id: 9, name: "Players Championship 6", date: "Mar 08", type: "players", players: 128, prize: 75000, cardRequired: true },
            { id: 10, name: "Players Championship 7", date: "Mar 21", type: "players", players: 128, prize: 75000, cardRequired: true },
            { id: 11, name: "Players Championship 8", date: "Mar 22", type: "players", players: 128, prize: 75000, cardRequired: true },
            { id: 12, name: "European Tour 1", date: "Apr 04", type: "euro-tour", players: 48, prize: 175000, cardRequired: true },
            { id: 13, name: "Players Championship 9", date: "Apr 18", type: "players", players: 128, prize: 75000, cardRequired: true },
            { id: 14, name: "Players Championship 10", date: "Apr 19", type: "players", players: 128, prize: 75000, cardRequired: true },
            { id: 15, name: "World Cup of Darts", date: "May 01", type: "world-cup", players: 64, prize: 450000, cardRequired: false, teamEvent: true },
            { id: 16, name: "European Tour 2", date: "May 15", type: "euro-tour", players: 48, prize: 175000, cardRequired: true },
            { id: 17, name: "Players Championship 11", date: "May 30", type: "players", players: 128, prize: 75000, cardRequired: true },
            { id: 18, name: "Players Championship 12", date: "May 31", type: "players", players: 128, prize: 75000, cardRequired: true },
            { id: 19, name: "Nordic Darts Masters", date: "Jun 12", type: "world-series", players: 8, prize: 60000, cardRequired: false, invitational: true },
            { id: 20, name: "European Tour 3", date: "Jun 20", type: "euro-tour", players: 48, prize: 175000, cardRequired: true },
            { id: 21, name: "World Matchplay", date: "Jul 12", type: "major", players: 32, prize: 800000, cardRequired: false, top32: true },
            { id: 22, name: "World Series Finals", date: "Aug 01", type: "major", players: 24, prize: 300000, cardRequired: false, wsQualification: true },
            { id: 23, name: "European Tour 4", date: "Aug 15", type: "euro-tour", players: 48, prize: 175000, cardRequired: true },
            { id: 24, name: "Players Championship 13", date: "Aug 29", type: "players", players: 128, prize: 75000, cardRequired: true },
            { id: 25, name: "Players Championship 14", date: "Aug 30", type: "players", players: 128, prize: 75000, cardRequired: true },
            { id: 26, name: "World Grand Prix", date: "Oct 03", type: "major", players: 32, prize: 600000, cardRequired: false, top32: true },
            { id: 27, name: "European Championship", date: "Oct 24", type: "major", players: 32, prize: 500000, cardRequired: false, euroTourQual: true },
            { id: 28, name: "Players Championship Finals", date: "Nov 21", type: "major", players: 64, prize: 500000, cardRequired: false, pcQualification: true },
            { id: 29, name: "Grand Slam of Darts", date: "Nov 08", type: "major", players: 32, prize: 650000, cardRequired: false, gsQualification: true },
            { id: 30, name: "World Championship", date: "Dec 15", type: "major", players: 96, prize: 2500000, cardRequired: false, worldsQualification: true },
        ];

        // ==================== CAREER SYSTEM ====================
        const Career = {
            state: null,
            playerType: 'custom',
            selectedExistingPlayer: null,

            // Initialize career
            init: () => {
                Career.renderPlayerList();
            },

            // Show screens
            showScreen: (screenId) => {
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                document.getElementById(screenId).classList.add('active');
            },

            showMainMenu: () => {
                Career.showScreen('main-menu');
            },

            showNewCareer: () => {
                Career.showScreen('create-screen');
                Career.setPlayerType('custom');
            },

            // Player type toggle
            setPlayerType: (type) => {
                Career.playerType = type;
                document.getElementById('type-custom').classList.toggle('active', type === 'custom');
                document.getElementById('type-existing').classList.toggle('active', type === 'existing');
                document.getElementById('custom-form').style.display = type === 'custom' ? 'block' : 'none';
                document.getElementById('existing-form').style.display = type === 'existing' ? 'block' : 'none';
            },

            // Update starting stats based on level
            updateStartingStats: () => {
                const level = document.getElementById('player-level').value;
                let avg, co, form;
                
                switch(level) {
                    case 'amateur':
                        avg = (65 + Math.random() * 5).toFixed(1);
                        co = Math.floor(28 + Math.random() * 6);
                        form = 40;
                        break;
                    case 'semi-pro':
                        avg = (75 + Math.random() * 5).toFixed(1);
                        co = Math.floor(32 + Math.random() * 6);
                        form = 50;
                        break;
                    case 'professional':
                        avg = (85 + Math.random() * 3).toFixed(1);
                        co = Math.floor(36 + Math.random() * 5);
                        form = 60;
                        break;
                }
                
                document.getElementById('stat-avg').textContent = avg;
                document.getElementById('stat-co').textContent = co + '%';
                document.getElementById('stat-form').textContent = form;
            },

            // Render player list for existing player selection
            renderPlayerList: () => {
                const container = document.getElementById('player-list');
                if (!container) return;
                
                const searchTerm = (document.getElementById('player-search')?.value || '').toLowerCase();
                
                const filtered = PLAYERS_DB.filter(p => 
                    p.name.toLowerCase().includes(searchTerm)
                );
                
                container.innerHTML = filtered.map(p => {
                    const avgDisplay = (typeof p.avg === 'number') ? p.avg.toFixed(1) : '85.0';
                    return `
                        <div class="player-select-item ${Career.selectedExistingPlayer === p.name ? 'selected' : ''}" 
                             onclick="Career.selectExistingPlayer('${p.name.replace(/'/g, "\\'")}')">
                            <img src="https://flagcdn.com/w40/${Career.getCountryCode(p.country)}.png" 
                                 onerror="this.src='pdc-logo.png'">
                            <span class="name">${p.name}</span>
                            <span class="avg">${avgDisplay}</span>
                        </div>
                    `;
                }).join('');
            },

            filterPlayers: () => {
                Career.renderPlayerList();
            },

            selectExistingPlayer: (name) => {
                Career.selectedExistingPlayer = name;
                Career.renderPlayerList();
            },

            getCountryCode: (country) => {
                if (!country) return 'gb-eng';
                const c = country.toLowerCase().trim();
                
                // Short codes from database
                const shortCodes = {
                    'eng': 'gb-eng', 'sco': 'gb-sct', 'wal': 'gb-wls', 'nir': 'gb-nir',
                    'nl': 'nl', 'bel': 'be', 'ger': 'de', 'aut': 'at', 'aus': 'au',
                    'usa': 'us', 'can': 'ca', 'irl': 'ie', 'pl': 'pl', 'pol': 'pl',
                    'cze': 'cz', 'hun': 'hu', 'por': 'pt', 'esp': 'es', 'fra': 'fr',
                    'jpn': 'jp', 'phi': 'ph', 'chn': 'cn', 'rsa': 'za', 'nzl': 'nz',
                    'swe': 'se', 'den': 'dk', 'nor': 'no', 'fin': 'fi', 'lit': 'lt',
                    'lat': 'lv', 'gre': 'gr', 'ita': 'it', 'cro': 'hr', 'svk': 'sk',
                    'sgp': 'sg', 'hkg': 'hk', 'bra': 'br', 'sui': 'ch', 'rou': 'ro',
                    'ukr': 'ua', 'rus': 'ru', 'svn': 'si', 'srb': 'rs', 'mex': 'mx',
                    'arg': 'ar', 'col': 'co', 'chl': 'cl', 'tha': 'th', 'mys': 'my',
                    'ind': 'in', 'kor': 'kr', 'twn': 'tw', 'idn': 'id', 'gbr': 'gb'
                };
                
                // Full country names
                const fullNames = {
                    'england': 'gb-eng', 'scotland': 'gb-sct', 'wales': 'gb-wls',
                    'northern ireland': 'gb-nir', 'netherlands': 'nl', 'belgium': 'be',
                    'germany': 'de', 'austria': 'at', 'australia': 'au', 'usa': 'us',
                    'united states': 'us', 'canada': 'ca', 'ireland': 'ie', 'poland': 'pl',
                    'czech republic': 'cz', 'czechia': 'cz', 'hungary': 'hu', 
                    'portugal': 'pt', 'spain': 'es', 'france': 'fr', 'japan': 'jp',
                    'philippines': 'ph', 'china': 'cn', 'south africa': 'za',
                    'new zealand': 'nz', 'sweden': 'se', 'denmark': 'dk', 'norway': 'no',
                    'finland': 'fi', 'lithuania': 'lt', 'latvia': 'lv', 'greece': 'gr',
                    'italy': 'it', 'croatia': 'hr', 'slovakia': 'sk', 'singapore': 'sg',
                    'hong kong': 'hk', 'brazil': 'br', 'switzerland': 'ch', 'romania': 'ro',
                    'ukraine': 'ua', 'russia': 'ru', 'slovenia': 'si', 'serbia': 'rs',
                    'mexico': 'mx', 'argentina': 'ar', 'colombia': 'co', 'chile': 'cl',
                    'thailand': 'th', 'malaysia': 'my', 'india': 'in', 'south korea': 'kr',
                    'taiwan': 'tw', 'indonesia': 'id', 'united kingdom': 'gb'
                };
                
                return shortCodes[c] || fullNames[c] || 'gb-eng';
            },

            // Get short country code for eligibility checking
            getCountryShortCode: (country) => {
                if (!country) return 'eng';
                const c = country.toLowerCase().trim();
                
                // If already a short code, return it
                const shortCodes = ['eng', 'sco', 'wal', 'nir', 'irl', 'nl', 'bel', 'ger', 'aut', 'aus',
                    'usa', 'can', 'pl', 'pol', 'cze', 'hun', 'por', 'esp', 'fra', 'jpn', 'phi', 'chn',
                    'rsa', 'nzl', 'swe', 'den', 'nor', 'fin', 'lit', 'lat', 'gre', 'ita', 'cro', 'svk',
                    'sgp', 'hkg', 'bra', 'sui', 'rou', 'ukr', 'rus', 'svn', 'srb', 'mex', 'arg', 'col',
                    'chl', 'tha', 'mys', 'ind', 'kor', 'twn', 'idn', 'gbr'];
                if (shortCodes.includes(c)) return c;
                
                // Convert full names to short codes
                const fullToShort = {
                    'england': 'eng', 'scotland': 'sco', 'wales': 'wal',
                    'northern ireland': 'nir', 'ireland': 'irl', 'netherlands': 'nl',
                    'belgium': 'bel', 'germany': 'ger', 'austria': 'aut', 'australia': 'aus',
                    'usa': 'usa', 'united states': 'usa', 'canada': 'can', 'poland': 'pl',
                    'czech republic': 'cze', 'czechia': 'cze', 'hungary': 'hun',
                    'portugal': 'por', 'spain': 'esp', 'france': 'fra', 'japan': 'jpn',
                    'philippines': 'phi', 'china': 'chn', 'south africa': 'rsa',
                    'new zealand': 'nzl', 'sweden': 'swe', 'denmark': 'den', 'norway': 'nor',
                    'finland': 'fin', 'lithuania': 'lit', 'latvia': 'lat', 'greece': 'gre',
                    'italy': 'ita', 'croatia': 'cro', 'slovakia': 'svk', 'singapore': 'sgp',
                    'hong kong': 'hkg', 'brazil': 'bra', 'switzerland': 'sui', 'romania': 'rou',
                    'ukraine': 'ukr', 'russia': 'rus', 'slovenia': 'svn', 'serbia': 'srb',
                    'mexico': 'mex', 'argentina': 'arg', 'colombia': 'col', 'chile': 'chl',
                    'thailand': 'tha', 'malaysia': 'mys', 'india': 'ind', 'south korea': 'kor',
                    'taiwan': 'twn', 'indonesia': 'idn', 'united kingdom': 'gbr'
                };
                
                return fullToShort[c] || 'eng';
            },

            // Start new career
            startCareer: () => {
                let player;
                
                if (Career.playerType === 'custom') {
                    const name = document.getElementById('player-name').value.trim();
                    if (!name) {
                        Career.notify('Please enter a player name!', 'error');
                        return;
                    }
                    
                    const country = document.getElementById('player-country').value;
                    const avg = parseFloat(document.getElementById('stat-avg').textContent);
                    const co = parseInt(document.getElementById('stat-co').textContent);
                    const form = parseInt(document.getElementById('stat-form').textContent);
                    const level = document.getElementById('player-level').value;
                    
                    player = {
                        name: name,
                        country: country,
                        avg: avg,
                        co: co,
                        form: form,
                        fatigue: 0,
                        money: 0,
                        tourCard: level === 'professional',
                        isCustom: true
                    };
                } else {
                    if (!Career.selectedExistingPlayer) {
                        Career.notify('Please select a player!', 'error');
                        return;
                    }
                    
                    const existing = PLAYERS_DB.find(p => p.name === Career.selectedExistingPlayer);
                    player = {
                        ...existing,
                        form: 60 + Math.random() * 20,
                        fatigue: 0,
                        isCustom: false
                    };
                }
                
                // Initialize career state
                Career.state = {
                    player: player,
                    week: 1,
                    year: 2026,
                    events: JSON.parse(JSON.stringify(EVENTS_DB)),
                    completedEvents: [],
                    currentEventIndex: 0,
                    stats: {
                        eventsPlayed: 0,
                        wins: 0,
                        finals: 0,
                        semiFinals: 0,
                        total180s: 0,
                        highestCheckout: 0,
                        matchesWon: 0,
                        matchesLost: 0
                    },
                    orderOfMerit: {},
                    proTourOOM: {},
                    qualifications: {
                        ukOpen: false,
                        worldMatchplay: false,
                        worldGrandPrix: false,
                        euroChamp: false,
                        pcFinals: false,
                        grandSlam: false,
                        worldSeries: false,
                        worlds: false,
                        winmauMasters: false
                    }
                };
                
                // Initialize OOM with existing players
                PLAYERS_DB.forEach(p => {
                    Career.state.orderOfMerit[p.name] = p.money || 0;
                });
                Career.state.orderOfMerit[player.name] = player.money || 0;
                
                Career.showScreen('dashboard-screen');
                Career.renderDashboard();
                Career.notify('Career started! Good luck on your journey!', 'success');
            },

            // Render dashboard
            renderDashboard: () => {
                if (!Career.state) return;
                
                const p = Career.state.player;
                
                // Player card
                document.getElementById('dash-flag').src = `https://flagcdn.com/w80/${Career.getCountryCode(p.country)}.png`;
                document.getElementById('dash-name').textContent = p.name;
                document.getElementById('dash-rank').textContent = `World Rank: #${Career.getWorldRank()}`;
                document.getElementById('dash-avg').textContent = p.avg.toFixed(1);
                document.getElementById('dash-co').textContent = Math.round(p.co) + '%';
                document.getElementById('dash-money').textContent = '¬£' + p.money.toLocaleString();
                
                // Week/Date
                document.getElementById('current-week').textContent = Career.state.week;
                document.getElementById('current-date').textContent = Career.getDateFromWeek(Career.state.week);
                
                // Fatigue & Form bars
                document.getElementById('fatigue-bar').style.width = p.fatigue + '%';
                document.getElementById('fatigue-value').textContent = Math.round(p.fatigue);
                document.getElementById('form-bar').style.width = p.form + '%';
                document.getElementById('form-value').textContent = Math.round(p.form);
                
                // Stats
                document.getElementById('stats-played').textContent = Career.state.stats.eventsPlayed;
                document.getElementById('stats-wins').textContent = Career.state.stats.wins;
                document.getElementById('stats-finals').textContent = Career.state.stats.finals;
                document.getElementById('stats-semis').textContent = Career.state.stats.semiFinals;
                document.getElementById('stats-180s').textContent = Career.state.stats.total180s;
                document.getElementById('stats-highco').textContent = Career.state.stats.highestCheckout;
                
                // Event list
                Career.renderEventList();
                
                // Update button states
                Career.updateActionButtons();
            },

            getWorldRank: () => {
                const sorted = Object.entries(Career.state.orderOfMerit)
                    .sort((a, b) => b[1] - a[1]);
                const rank = sorted.findIndex(e => e[0] === Career.state.player.name) + 1;
                return rank || 128;
            },

            getDateFromWeek: (week) => {
                const months = ['January', 'February', 'March', 'April', 'May', 'June', 
                               'July', 'August', 'September', 'October', 'November', 'December'];
                const monthIndex = Math.floor((week - 1) / 4.33);
                return months[Math.min(monthIndex, 11)] + ' ' + Career.state.year;
            },

            // Render event list
            renderEventList: () => {
                const container = document.getElementById('event-list');
                const currentWeek = Career.state.week;
                
                container.innerHTML = Career.state.events.map((ev, idx) => {
                    const isCompleted = Career.state.completedEvents.find(c => c.id === ev.id);
                    const isCurrent = idx === Career.state.currentEventIndex && !isCompleted;
                    const eligibility = Career.checkEligibility(ev);
                    
                    let statusClass = '';
                    let statusText = '';
                    
                    if (isCompleted) {
                        statusClass = 'completed';
                        statusText = `<span class="event-status" style="background:#333;color:#888;">‚úì ${isCompleted.result}</span>`;
                    } else if (eligibility.eligible) {
                        statusText = `<span class="event-status eligible">‚úì Eligible</span>`;
                    } else {
                        statusClass = 'ineligible';
                        statusText = `<span class="event-status ineligible">‚úó ${eligibility.reason}</span>`;
                    }
                    
                    return `
                        <div class="event-item ${statusClass} ${isCurrent ? 'current' : ''}" 
                             onclick="Career.showEventModal(${idx})">
                            <div class="event-date">${ev.date}</div>
                            <div class="event-name">${ev.name}</div>
                            ${statusText}
                        </div>
                    `;
                }).join('');
            },

            // Check eligibility for an event (matches darts.html logic)
            checkEligibility: (event) => {
                const p = Career.state.player;
                const rank = Career.getWorldRank();
                const type = event.type || '';
                const playerCountry = Career.getCountryShortCode(p.country);
                
                // Q-School: Must NOT have tour card, must be in eligible region
                if (type === 'q-school') {
                    if (p.tourCard) {
                        return { eligible: false, reason: 'Tour Card holders cannot enter' };
                    }
                    if (event.eligibleRegions && event.eligibleRegions.length > 0) {
                        if (!event.eligibleRegions.includes(playerCountry)) {
                            return { eligible: false, reason: `Not in eligible region (${event.location?.toUpperCase() || 'Region'})` };
                        }
                    }
                    return { eligible: true, reason: '' };
                }
                
                // Challenge Tour: Must NOT have tour card
                if (type === 'challenge') {
                    if (p.tourCard) {
                        return { eligible: false, reason: 'Tour Card holders cannot enter' };
                    }
                    return { eligible: true, reason: '' };
                }
                
                // Tour card required events (Players Championship, Premier League, most events)
                if (event.cardRequired && !p.tourCard) {
                    return { eligible: false, reason: 'No Tour Card' };
                }
                
                // Premier League - Top 8 only (invitation based)
                if (type === 'premier-league' || type === 'premier-league-playoff') {
                    if (rank > 8) {
                        return { eligible: false, reason: 'Top 8 Only (Invitation)' };
                    }
                    return { eligible: true, reason: '' };
                }
                
                // World Masters qualifiers - open to all
                if (type === 'wmasters-qual') {
                    return { eligible: true, reason: '' };
                }
                
                // Winmau World Masters - Tour card required, qualification based
                if (type === 'winmaudm') {
                    if (!p.tourCard) {
                        return { eligible: false, reason: 'No Tour Card' };
                    }
                    if (!Career.state.qualifications.winmauMasters && rank > 24) {
                        return { eligible: false, reason: 'Not Qualified (Need top 24 or qualifier win)' };
                    }
                    return { eligible: true, reason: '' };
                }
                
                // Masters events (World Series) - Top 16 invitation
                if (type === 'masters') {
                    if (rank > 16) {
                        return { eligible: false, reason: 'Top 16 Only (Invitation)' };
                    }
                    return { eligible: true, reason: '' };
                }
                
                // ET Qualifiers - various requirements
                if (type === 'et-qual-tc') {
                    if (!p.tourCard) {
                        return { eligible: false, reason: 'No Tour Card' };
                    }
                    return { eligible: true, reason: '' };
                }
                
                if (type === 'et-host-nation' || type === 'et-east-european' || type === 'et-nordic-baltic') {
                    // Regional qualifiers - check if player is from eligible region
                    if (event.eligibleRegions && event.eligibleRegions.length > 0) {
                        if (!event.eligibleRegions.includes(playerCountry)) {
                            return { eligible: false, reason: 'Not in eligible region' };
                        }
                    }
                    return { eligible: true, reason: '' };
                }
                
                // European Tour (Minor) events - Tour card required
                if (type === 'minor') {
                    if (!p.tourCard) {
                        return { eligible: false, reason: 'No Tour Card' };
                    }
                    return { eligible: true, reason: '' };
                }
                
                // UK Open - Open entry but ranked players get better seeding
                if (type === 'uk-open') {
                    return { eligible: true, reason: '' };
                }
                
                // World Matchplay - Top 16 OOM + Top 16 Pro Tour
                if (type === 'matchplay') {
                    if (rank > 32) {
                        return { eligible: false, reason: 'Not in Top 32' };
                    }
                    return { eligible: true, reason: '' };
                }
                
                // World Grand Prix - Top 32 OOM (double start format)
                if (type === 'grandprix') {
                    if (rank > 32) {
                        return { eligible: false, reason: 'Not in Top 32' };
                    }
                    return { eligible: true, reason: '' };
                }
                
                // European Championship - Top 32 European Order of Merit
                if (type === 'european-championship') {
                    if (rank > 32) {
                        return { eligible: false, reason: 'Not in Top 32' };
                    }
                    return { eligible: true, reason: '' };
                }
                
                // Players Championship Finals - Top 64 Pro Tour Order of Merit
                if (type === 'pc-finals') {
                    if (rank > 64 && !Career.state.qualifications.pcFinals) {
                        return { eligible: false, reason: 'Not in Top 64 Pro Tour' };
                    }
                    return { eligible: true, reason: '' };
                }
                
                // Grand Slam - Major winners + qualifiers
                if (type === 'grand-slam' || type === 'grandslam') {
                    if (!Career.state.qualifications.grandSlam && rank > 16) {
                        return { eligible: false, reason: 'Not Qualified (Need major win or top ranking)' };
                    }
                    return { eligible: true, reason: '' };
                }
                
                // World Series Finals - World Series qualifiers
                if (type === 'ws-finals') {
                    if (!Career.state.qualifications.worldSeries && rank > 24) {
                        return { eligible: false, reason: 'Not Qualified' };
                    }
                    return { eligible: true, reason: '' };
                }
                
                // World Championship - Top 32 + qualifiers
                if (type === 'world') {
                    if (rank > 32 && !Career.state.qualifications.worlds) {
                        return { eligible: false, reason: 'Not Qualified (Need Top 32 or qualifier)' };
                    }
                    return { eligible: true, reason: '' };
                }
                
                // World Championship qualifiers
                if (type === 'wc-qual-intl' || type === 'wc-qual-tc') {
                    if (type === 'wc-qual-tc' && !p.tourCard) {
                        return { eligible: false, reason: 'No Tour Card' };
                    }
                    return { eligible: true, reason: '' };
                }
                
                // Grand Slam / World Series qualifiers
                if (type === 'gs-qual-tc' || type === 'ws-qual-tc') {
                    if (!p.tourCard) {
                        return { eligible: false, reason: 'No Tour Card' };
                    }
                    return { eligible: true, reason: '' };
                }
                
                // Default: eligible if has tour card or event doesn't require it
                return { eligible: true, reason: '' };
            },

            // Show event modal
            showEventModal: (idx) => {
                const ev = Career.state.events[idx];
                Career.currentEventIdx = idx;
                
                document.getElementById('modal-event-name').textContent = ev.name;
                document.getElementById('modal-event-date').textContent = ev.date;
                document.getElementById('modal-event-type').textContent = (ev.type || 'event').toUpperCase().replace(/-/g, ' ');
                document.getElementById('modal-event-players').textContent = `Players: ${ev.players}`;
                document.getElementById('modal-event-prize').textContent = ev.prize > 0 ? `Prize Pool: ¬£${ev.prize.toLocaleString()}` : 'No Prize Money';
                
                const eligibility = Career.checkEligibility(ev);
                const eligDiv = document.getElementById('modal-eligibility');
                const enterBtn = document.getElementById('btn-enter-event');
                
                const isCompleted = Career.state.completedEvents.find(c => c.id === ev.id);
                
                if (isCompleted) {
                    eligDiv.style.background = 'rgba(100, 100, 100, 0.2)';
                    eligDiv.innerHTML = `<span style="color:#888;">‚úì Completed - ${isCompleted.result}</span>`;
                    enterBtn.style.display = 'none';
                } else if (eligibility.eligible) {
                    eligDiv.style.background = 'rgba(0, 179, 89, 0.2)';
                    eligDiv.innerHTML = `<span style="color:var(--pdc-green);">‚úì You are eligible to enter this event</span>`;
                    enterBtn.style.display = 'block';
                    enterBtn.disabled = false;
                } else {
                    eligDiv.style.background = 'rgba(231, 76, 60, 0.2)';
                    eligDiv.innerHTML = `<span style="color:#e74c3c;">‚úó ${eligibility.reason}</span>`;
                    enterBtn.style.display = 'none';
                }
                
                document.getElementById('event-modal').classList.add('active');
            },

            closeEventModal: () => {
                document.getElementById('event-modal').classList.remove('active');
            },

            // Enter event - starts actual tournament bracket
            enterEvent: () => {
                Career.closeEventModal();
                
                const ev = Career.state.events[Career.currentEventIdx];
                CareerTournament.start(ev);
            },

            // Called when tournament is complete
            finishTournament: (result) => {
                const ev = Career.state.events[Career.currentEventIdx];
                const p = Career.state.player;
                
                // Add fatigue for playing
                p.fatigue = Math.min(100, p.fatigue + 15);
                
                // Record result
                Career.state.completedEvents.push({
                    id: ev.id,
                    name: ev.name,
                    result: result.position,
                    prize: result.prize
                });
                
                // Update stats
                Career.state.stats.eventsPlayed++;
                p.money += result.prize;
                Career.state.orderOfMerit[p.name] = (Career.state.orderOfMerit[p.name] || 0) + result.prize;
                
                if (result.position === '1st') {
                    Career.state.stats.wins++;
                    Career.state.stats.finals++;
                } else if (result.position === '2nd') {
                    Career.state.stats.finals++;
                } else if (result.position.includes('SF')) {
                    Career.state.stats.semiFinals++;
                }
                
                // Update form based on result
                if (result.position === '1st') p.form = Math.min(100, p.form + 10);
                else if (result.position === '2nd') p.form = Math.min(100, p.form + 5);
                else if (result.position.includes('QF')) p.form = Math.min(100, p.form + 2);
                else p.form = Math.max(0, p.form - 2);
                
                // Check qualifications
                Career.updateQualifications(ev, result.position);
                
                // Move to next event
                Career.state.currentEventIndex++;
                
                // Return to dashboard
                document.getElementById('tournament-screen').style.display = 'none';
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                document.getElementById('dashboard-screen').classList.add('active');
                
                Career.renderDashboard();
                Career.notify(`${ev.name}: ${result.position} - ¬£${result.prize.toLocaleString()}`, 'success');
            },

            // Update qualifications based on results
            updateQualifications: (event, position) => {
                const type = event.type || '';
                const isWin = position === '1st';
                const isFinal = position === '1st' || position === '2nd';
                const isSF = position === 'SF' || isFinal;
                
                // Q-School win gives Tour Card
                if (type === 'q-school' && isWin) {
                    Career.state.player.tourCard = true;
                    Career.notify('üéâ You earned a PDC Tour Card!', 'success');
                }
                
                // Winmau World Masters qualifier win
                if (type === 'wmasters-qual' && isWin) {
                    Career.state.qualifications.winmauMasters = true;
                }
                
                // European Tour (Minor) wins/finals qualify for European Championship
                if (type === 'minor' && isFinal) {
                    Career.state.qualifications.euroChamp = true;
                }
                
                // Players Championship good performances qualify for PC Finals
                if (type === 'players' && isSF) {
                    Career.state.qualifications.pcFinals = true;
                }
                
                // Masters (World Series) event wins qualify for WS Finals
                if (type === 'masters' && isWin) {
                    Career.state.qualifications.worldSeries = true;
                }
                
                // Major wins qualify for Grand Slam
                const majorTypes = ['matchplay', 'grandprix', 'uk-open', 'european-championship', 'world', 'pc-finals', 'ws-finals', 'winmaudm'];
                if (majorTypes.includes(type) && isWin) {
                    Career.state.qualifications.grandSlam = true;
                }
                
                // Challenge Tour good performances
                if (type === 'challenge' && isWin) {
                    // Challenge Tour winners can qualify for various events
                    Career.state.qualifications.pcFinals = true;
                }
                
                // World Championship qualifiers
                if ((type === 'wc-qual-intl' || type === 'wc-qual-tc') && isWin) {
                    Career.state.qualifications.worlds = true;
                }
                
                // Grand Slam qualifiers
                if (type === 'gs-qual-tc' && isWin) {
                    Career.state.qualifications.grandSlam = true;
                }
                
                // World Series qualifiers
                if (type === 'ws-qual-tc' && isWin) {
                    Career.state.qualifications.worldSeries = true;
                }
                
                // Top 32 in OOM qualifies for worlds
                if (Career.getWorldRank() <= 32) {
                    Career.state.qualifications.worlds = true;
                }
                
                // Top 64 qualifies for PC Finals
                if (Career.getWorldRank() <= 64) {
                    Career.state.qualifications.pcFinals = true;
                }
            },

            // Tab switching
            switchTab: (tab) => {
                document.querySelectorAll('.tab-content').forEach(t => t.style.display = 'none');
                document.querySelectorAll('.tabs .tab-btn').forEach(b => b.classList.remove('active'));
                
                document.getElementById('tab-' + tab).style.display = 'block';
                event.target.classList.add('active');
                
                if (tab === 'standings') {
                    Career.renderStandings('oom');
                }
            },

            switchStandings: (type) => {
                document.querySelectorAll('#tab-standings .tabs .tab-btn').forEach(b => b.classList.remove('active'));
                event.target.classList.add('active');
                Career.renderStandings(type);
            },

            renderStandings: (type) => {
                const container = document.getElementById('standings-content');
                const data = type === 'oom' ? Career.state.orderOfMerit : Career.state.proTourOOM;
                
                const sorted = Object.entries(data).sort((a, b) => b[1] - a[1]).slice(0, 50);
                const playerName = Career.state.player.name;
                
                container.innerHTML = `
                    <table class="standings-table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Player</th>
                                <th>Prize Money</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${sorted.map(([name, money], idx) => `
                                <tr class="${name === playerName ? 'highlight' : ''}">
                                    <td>${idx + 1}</td>
                                    <td>${name}</td>
                                    <td>¬£${money.toLocaleString()}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            },

            // Free time actions
            rest: () => {
                const p = Career.state.player;
                p.fatigue = Math.max(0, p.fatigue - 20);
                Career.advanceWeek();
                Career.notify('You rested. Fatigue reduced by 20.', 'success');
            },

            train: () => {
                const p = Career.state.player;
                
                // Training effects
                const avgGain = 0.05 + Math.random() * 0.1;
                const coGain = 0.1 + Math.random() * 0.2;
                
                p.avg = Math.min(100, p.avg + avgGain);
                p.co = Math.min(50, p.co + coGain);
                p.fatigue = Math.min(100, p.fatigue + 10);
                
                Career.advanceWeek();
                Career.notify(`Training complete! Avg +${avgGain.toFixed(2)}, CO +${coGain.toFixed(1)}%`, 'success');
            },

            advanceWeek: () => {
                Career.state.week++;
                
                // Natural fatigue recovery
                Career.state.player.fatigue = Math.max(0, Career.state.player.fatigue - 5);
                
                // Year rollover
                if (Career.state.week > 52) {
                    Career.state.week = 1;
                    Career.state.year++;
                    Career.notify('Happy New Year! Season ' + Career.state.year + ' begins!', 'success');
                }
                
                Career.renderDashboard();
            },

            updateActionButtons: () => {
                const p = Career.state.player;
                document.getElementById('btn-rest').disabled = p.fatigue <= 0;
                document.getElementById('btn-train').disabled = p.fatigue >= 90;
            },

            // Notifications
            notify: (message, type = 'info') => {
                const notif = document.getElementById('notification');
                notif.textContent = message;
                notif.style.display = 'block';
                notif.style.borderColor = type === 'error' ? '#e74c3c' : type === 'success' ? 'var(--pdc-green)' : 'var(--pdc-gold)';
                
                setTimeout(() => {
                    notif.style.display = 'none';
                }, 3000);
            },

            // Save/Load with differentiation from season mode
            saveGame: () => {
                if (!Career.state) {
                    Career.notify('No career to save!', 'error');
                    return;
                }
                
                const saveData = {
                    type: 'career', // Differentiates from season saves
                    version: '1.0',
                    timestamp: Date.now(),
                    state: Career.state
                };
                
                localStorage.setItem('pdc_career_save', JSON.stringify(saveData));
                Career.notify('Career saved locally!', 'success');
                
                // Also save to cloud if logged in
                if (AuthSystem.currentUser) {
                    Career.saveToCloud().catch(e => console.log('Auto-save to cloud failed:', e.message));
                }
            },

            // Cloud save using shared AuthSystem
            saveToCloud: async () => {
                if (!AuthSystem.currentUser) {
                    Career.notify('Please log in to save to server', 'error');
                    return;
                }
                if (!Career.state) {
                    Career.notify('No career to save!', 'error');
                    return;
                }

                try {
                    const saveBtn = document.getElementById('auth-save-btn');
                    if (saveBtn) saveBtn.innerText = '‚è≥ Saving...';

                    const careerState = {
                        type: 'career',
                        version: '1.0',
                        state: Career.state,
                        savedAt: Date.now()
                    };

                    const result = await AuthSystem.saveCareerToCloud(careerState);

                    if (result.success) {
                        if (saveBtn) {
                            saveBtn.innerText = '‚úì Saved!';
                            setTimeout(() => saveBtn.innerText = 'üíæ SAVE CAREER TO SERVER', 2000);
                        }
                        document.getElementById('auth-last-sync').innerText = new Date().toLocaleString();
                        Career.notify('Career saved to server!', 'success');
                    } else {
                        throw new Error(result.error || 'Save failed');
                    }
                } catch (e) {
                    console.error('Save error:', e);
                    Career.notify('Failed to save. Check connection.', 'error');
                    const saveBtn = document.getElementById('auth-save-btn');
                    if (saveBtn) saveBtn.innerText = 'üíæ SAVE CAREER TO SERVER';
                }
            },

            // Cloud load using shared AuthSystem
            loadFromCloud: async () => {
                if (!AuthSystem.currentUser) {
                    Career.notify('Please log in to load from server', 'error');
                    return false;
                }

                try {
                    const loadBtn = document.getElementById('auth-load-btn');
                    if (loadBtn) loadBtn.innerText = '‚è≥ Loading...';

                    const result = await AuthSystem.loadCareerFromCloud();

                    if (result.success && result.data && result.data.state) {
                        Career.state = result.data.state;
                        
                        // Also save locally
                        localStorage.setItem('pdc_career_save', JSON.stringify(result.data));
                        
                        Career.showScreen('dashboard-screen');
                        Career.renderDashboard();

                        if (loadBtn) {
                            loadBtn.innerText = '‚úì Loaded!';
                            setTimeout(() => loadBtn.innerText = 'üì• LOAD CAREER FROM SERVER', 2000);
                        }
                        Career.notify('Career loaded from server!', 'success');
                        return true;
                    } else {
                        if (loadBtn) loadBtn.innerText = 'üì• LOAD CAREER FROM SERVER';
                        Career.notify('No career save found on server', 'error');
                        return false;
                    }
                } catch (e) {
                    console.error('Load error:', e);
                    const loadBtn = document.getElementById('auth-load-btn');
                    if (loadBtn) loadBtn.innerText = 'üì• LOAD CAREER FROM SERVER';
                    Career.notify('Failed to load. Check connection.', 'error');
                    return false;
                }
            },

            loadGame: () => {
                try {
                    const saveJson = localStorage.getItem('pdc_career_save');
                    if (!saveJson) {
                        Career.notify('No saved career found!', 'error');
                        return;
                    }
                    
                    const saveData = JSON.parse(saveJson);
                    
                    // Verify it's a career save
                    if (saveData.type !== 'career') {
                        Career.notify('Invalid save data!', 'error');
                        return;
                    }
                    
                    Career.state = saveData.state;
                    Career.showScreen('dashboard-screen');
                    Career.renderDashboard();
                    Career.notify('Career loaded successfully!', 'success');
                    
                } catch (e) {
                    console.error('Load error:', e);
                    Career.notify('Failed to load career!', 'error');
                }
            },

            // Delete career save
            deleteSave: () => {
                if (confirm('Are you sure you want to delete your career save?')) {
                    localStorage.removeItem('pdc_career_save');
                    Career.notify('Career save deleted.', 'success');
                }
            }
        };

        // ==================== CAREER TOURNAMENT SYSTEM ====================
        const CareerTournament = {
            state: {
                active: false,
                event: null,
                bracketData: [],
                rounds: [],
                currentRound: 0,
                playerPosition: null, // Track player's position in bracket
                playerEliminated: false,
                prizeWon: 0
            },

            // Start a tournament
            start: (event) => {
                const playerCount = event.players || 128;
                const numRounds = Math.log2(playerCount);
                const eventType = event.type || 'players';
                
                // Build rounds configuration from ROUND_FORMATS
                const formats = ROUND_FORMATS[eventType] || ROUND_FORMATS['players'];
                const rounds = [];
                let playersInRound = playerCount;
                
                for (let i = 0; i < numRounds; i++) {
                    const roundName = getRoundName(playersInRound);
                    rounds.push({
                        name: roundName,
                        target: formats[roundName] || 6,
                        playersRemaining: playersInRound
                    });
                    playersInRound = playersInRound / 2;
                }
                
                // Build participant list
                const careerPlayer = { ...Career.state.player, isCareerPlayer: true };
                let participants = [careerPlayer];
                
                // Add other eligible players
                const eligiblePlayers = CareerTournament.getEligiblePlayers(event);
                
                // Shuffle and take needed count
                for (let i = eligiblePlayers.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [eligiblePlayers[i], eligiblePlayers[j]] = [eligiblePlayers[j], eligiblePlayers[i]];
                }
                
                participants = participants.concat(eligiblePlayers.slice(0, playerCount - 1));
                
                // Seed the bracket
                const seededBracket = CareerTournament.seedBracket(participants, playerCount);
                
                // Find player's position
                const playerIdx = seededBracket.findIndex(p => p && p.isCareerPlayer);
                
                // Create first round matches
                const r0 = [];
                for (let i = 0; i < seededBracket.length; i += 2) {
                    r0.push({
                        p1: seededBracket[i],
                        p2: seededBracket[i + 1],
                        winner: null,
                        score: null,
                        averages: null
                    });
                }
                
                // Initialize state
                CareerTournament.state = {
                    active: true,
                    event: event,
                    bracketData: [r0],
                    rounds: rounds,
                    currentRound: 0,
                    playerPosition: Math.floor(playerIdx / 2),
                    playerEliminated: false,
                    prizeWon: 0
                };
                
                // Initialize remaining rounds
                for (let i = 1; i < numRounds; i++) {
                    CareerTournament.state.bracketData.push([]);
                }
                
                // Show tournament screen
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                document.getElementById('tournament-screen').style.display = 'flex';
                document.getElementById('tourn-title').textContent = event.name;
                
                CareerTournament.renderBracket();
            },

            getEligiblePlayers: (event) => {
                const type = event.type || 'players';
                let eligible = [];
                
                if (type === 'q-school') {
                    eligible = PLAYERS_DB.filter(p => !p.tourCard && p.name !== Career.state.player.name);
                } else if (type === 'challenge') {
                    eligible = PLAYERS_DB.filter(p => !p.tourCard && p.name !== Career.state.player.name);
                } else {
                    eligible = PLAYERS_DB.filter(p => p.tourCard && p.name !== Career.state.player.name);
                }
                
                return eligible.map(p => ({ ...p }));
            },

            seedBracket: (participants, size) => {
                // Sort by average (descending)
                const sorted = [...participants].sort((a, b) => {
                    if (!a) return 1;
                    if (!b) return -1;
                    return (b.avg || 0) - (a.avg || 0);
                });
                
                // Add seed numbers
                sorted.forEach((p, i) => {
                    if (p) p.seed = i + 1;
                });
                
                // Generate bracket order
                const order = CareerTournament.generateBracketOrder(size);
                const bracket = [];
                
                order.forEach(seedNum => {
                    if (seedNum <= sorted.length) {
                        bracket.push(sorted[seedNum - 1]);
                    } else {
                        bracket.push(null);
                    }
                });
                
                return bracket;
            },

            generateBracketOrder: (size) => {
                if (size === 2) return [1, 2];
                if (size === 1) return [1];
                
                const halfSize = size / 2;
                const topHalf = CareerTournament.generateBracketOrder(halfSize);
                const bottomHalf = topHalf.map(seed => size + 1 - seed);
                
                const result = [];
                for (let i = 0; i < topHalf.length; i++) {
                    result.push(topHalf[i]);
                    result.push(bottomHalf[i]);
                }
                return result;
            },

            renderBracket: () => {
                const container = document.getElementById('bracket-container');
                container.innerHTML = '';
                
                CareerTournament.state.rounds.forEach((roundInfo, roundIdx) => {
                    const matches = CareerTournament.state.bracketData[roundIdx] || [];
                    const column = document.createElement('div');
                    column.className = 'bracket-round-column';
                    
                    // Header
                    const header = document.createElement('div');
                    header.className = 'round-column-header';
                    header.innerHTML = `
                        <div class="round-column-name">${roundInfo.name}</div>
                        <div class="round-column-format">First to ${roundInfo.target} Legs</div>
                    `;
                    column.appendChild(header);
                    
                    // Matches list
                    const matchesList = document.createElement('div');
                    matchesList.className = 'bracket-matches-list';
                    
                    if (matches.length === 0) {
                        matchesList.innerHTML = '<div style="text-align:center; color:#555; padding:20px;">Awaiting Results</div>';
                    } else {
                        matches.forEach((m, idx) => {
                            const wrapper = document.createElement('div');
                            wrapper.className = 'bracket-match-wrapper';
                            if (m.winner) wrapper.classList.add('completed');
                            
                            const card = document.createElement('div');
                            card.className = 'bracket-match';
                            if (m.winner) card.classList.add('completed');
                            
                            // Check if this is player's match
                            const isPlayerMatch = (m.p1 && m.p1.isCareerPlayer) || (m.p2 && m.p2.isCareerPlayer);
                            if (isPlayerMatch && !m.winner) card.classList.add('player-match');
                            
                            const getPlayerHTML = (p, score, avg, isWinner) => {
                                if (!p) return '<div class="bm-row" style="color:#333;">TBD</div>';
                                const flag = `https://flagcdn.com/w40/${Career.getCountryCode(p.country)}.png`;
                                const style = isWinner ? "color:var(--pdc-gold); font-weight:900;" : 
                                             (m.winner ? "color:#555; text-decoration:line-through;" : "color:#aaa;");
                                const seedTxt = p.seed && !m.winner ? ` (${p.seed})` : '';
                                const avgTxt = avg ? ` (${avg})` : '';
                                const youTag = p.isCareerPlayer ? ' <span style="color:var(--pdc-green); font-size:10px;">YOU</span>' : '';
                                
                                return `
                                    <div class="bm-row" style="${style}">
                                        <img src="${flag}" class="bm-flag" onerror="this.style.display='none'">
                                        <span class="bm-name">${p.name}${seedTxt}${youTag}</span>
                                        <span class="bm-avg">${avgTxt}</span>
                                        <span class="bm-score">${score !== null ? score : ''}</span>
                                    </div>
                                `;
                            };
                            
                            let html = '<div class="bm-content">';
                            html += getPlayerHTML(m.p1, m.score?.[0], m.averages?.[0], m.winner === m.p1);
                            html += getPlayerHTML(m.p2, m.score?.[1], m.averages?.[1], m.winner === m.p2);
                            html += '</div>';
                            
                            // Add action buttons for playable matches
                            if (!m.winner && m.p1 && m.p2 && roundIdx === CareerTournament.state.currentRound) {
                                if (isPlayerMatch) {
                                    html += `<button class="btn-play-match" onclick="CareerTournament.playMatch(${roundIdx}, ${idx})">‚ñ∂ PLAY</button>`;
                                } else {
                                    html += `<button class="btn-sim-match" onclick="CareerTournament.simMatch(${roundIdx}, ${idx})">SIM</button>`;
                                }
                            }
                            
                            card.innerHTML = html;
                            wrapper.appendChild(card);
                            matchesList.appendChild(wrapper);
                        });
                    }
                    
                    column.appendChild(matchesList);
                    container.appendChild(column);
                });
            },

            playMatch: (roundIdx, matchIdx) => {
                const match = CareerTournament.state.bracketData[roundIdx][matchIdx];
                const roundInfo = CareerTournament.state.rounds[roundIdx];
                
                CareerMatch.start(match, roundInfo, roundIdx, matchIdx);
            },

            simMatch: (roundIdx, matchIdx) => {
                const match = CareerTournament.state.bracketData[roundIdx][matchIdx];
                const roundInfo = CareerTournament.state.rounds[roundIdx];
                const target = roundInfo.target;
                
                // Fast simulation
                let s1 = 0, s2 = 0;
                const eff1 = match.p1.avg || 85;
                const eff2 = match.p2.avg || 85;
                let winProbP1 = 0.50 + ((eff1 - eff2) * 0.025);
                winProbP1 = Math.max(0.01, Math.min(0.99, winProbP1));
                
                while (s1 < target && s2 < target) {
                    if (Math.random() < winProbP1) s1++; else s2++;
                }
                
                match.score = [s1, s2];
                match.winner = (s1 > s2) ? match.p1 : match.p2;
                match.averages = [
                    (eff1 + (Math.random() * 10 - 5)).toFixed(1),
                    (eff2 + (Math.random() * 10 - 5)).toFixed(1)
                ];
                
                CareerTournament.checkRoundComplete();
                CareerTournament.renderBracket();
            },

            simCurrentRound: () => {
                const roundIdx = CareerTournament.state.currentRound;
                const matches = CareerTournament.state.bracketData[roundIdx];
                
                matches.forEach((m, idx) => {
                    if (!m.winner && m.p1 && m.p2) {
                        // Check if it's player's match
                        const isPlayerMatch = (m.p1 && m.p1.isCareerPlayer) || (m.p2 && m.p2.isCareerPlayer);
                        if (!isPlayerMatch) {
                            CareerTournament.simMatch(roundIdx, idx);
                        }
                    }
                });
            },

            checkRoundComplete: () => {
                const roundIdx = CareerTournament.state.currentRound;
                const matches = CareerTournament.state.bracketData[roundIdx];
                
                // Check if all matches are complete
                const allDone = matches.every(m => m.winner);
                if (!allDone) return;
                
                // Check if player was eliminated
                const playerMatch = matches.find(m => 
                    (m.p1 && m.p1.isCareerPlayer) || (m.p2 && m.p2.isCareerPlayer)
                );
                
                if (playerMatch) {
                    const playerWon = playerMatch.winner && playerMatch.winner.isCareerPlayer;
                    if (!playerWon) {
                        CareerTournament.state.playerEliminated = true;
                        CareerTournament.endTournament();
                        return;
                    }
                }
                
                // Advance to next round
                if (roundIdx < CareerTournament.state.rounds.length - 1) {
                    CareerTournament.advanceRound();
                } else {
                    // Tournament complete
                    CareerTournament.endTournament();
                }
            },

            advanceRound: () => {
                const roundIdx = CareerTournament.state.currentRound;
                const matches = CareerTournament.state.bracketData[roundIdx];
                const nextRound = [];
                
                // Create next round matches from winners
                for (let i = 0; i < matches.length; i += 2) {
                    nextRound.push({
                        p1: matches[i].winner,
                        p2: matches[i + 1] ? matches[i + 1].winner : null,
                        winner: null,
                        score: null,
                        averages: null
                    });
                }
                
                CareerTournament.state.bracketData[roundIdx + 1] = nextRound;
                CareerTournament.state.currentRound++;
                CareerTournament.renderBracket();
            },

            endTournament: () => {
                const event = CareerTournament.state.event;
                const eventType = event.type || 'players';
                const prizeStructure = PRIZE_STRUCTURE[eventType] || PRIZE_STRUCTURE['players'];
                
                // Determine player's final position
                let position = 'L64';
                let playersRemaining = event.players;
                
                if (CareerTournament.state.playerEliminated) {
                    // Player was eliminated - find which round
                    const elimRound = CareerTournament.state.currentRound;
                    playersRemaining = CareerTournament.state.rounds[elimRound].playersRemaining;
                    position = getRoundName(playersRemaining);
                } else {
                    // Player won the tournament
                    const lastRoundMatches = CareerTournament.state.bracketData[CareerTournament.state.rounds.length - 1];
                    if (lastRoundMatches && lastRoundMatches[0]) {
                        const finalMatch = lastRoundMatches[0];
                        if (finalMatch.winner && finalMatch.winner.isCareerPlayer) {
                            position = '1st';
                            playersRemaining = 1;
                        } else {
                            position = '2nd';
                            playersRemaining = 2;
                        }
                    }
                }
                
                // Calculate prize money
                const prize = prizeStructure[playersRemaining] || 0;
                
                CareerTournament.state.active = false;
                
                // Return result to Career
                Career.finishTournament({
                    position: position,
                    prize: prize
                });
            },

            exitTournament: () => {
                if (confirm('Are you sure you want to exit? You will forfeit the tournament.')) {
                    CareerTournament.state.playerEliminated = true;
                    CareerTournament.endTournament();
                }
            }
        };

        // ==================== CAREER MATCH SYSTEM ====================
        const CareerMatch = {
            state: {
                active: false,
                match: null,
                roundInfo: null,
                roundIdx: 0,
                matchIdx: 0,
                p1Score: 0,
                p2Score: 0,
                p1Remaining: 501,
                p2Remaining: 501,
                currentThrower: 1,
                legNumber: 1,
                p1TotalPoints: 0,
                p2TotalPoints: 0,
                p1Darts: 0,
                p2Darts: 0,
                visitLog: []
            },

            start: (match, roundInfo, roundIdx, matchIdx) => {
                CareerMatch.state = {
                    active: true,
                    match: match,
                    roundInfo: roundInfo,
                    roundIdx: roundIdx,
                    matchIdx: matchIdx,
                    p1Score: 0,
                    p2Score: 0,
                    p1Remaining: 501,
                    p2Remaining: 501,
                    currentThrower: 1,
                    legNumber: 1,
                    legStarter: 1,
                    p1TotalPoints: 0,
                    p2TotalPoints: 0,
                    p1Darts: 0,
                    p2Darts: 0,
                    visitLog: []
                };
                
                // Show match screen
                document.getElementById('tournament-screen').style.display = 'none';
                document.getElementById('match-screen').style.display = 'flex';
                
                CareerMatch.renderMatch();
            },

            renderMatch: () => {
                const s = CareerMatch.state;
                const m = s.match;
                const target = s.roundInfo.target;
                
                document.getElementById('match-event-name').textContent = CareerTournament.state.event.name;
                document.getElementById('match-round-info').textContent = `${s.roundInfo.name} - First to ${target} Legs`;
                
                // Player 1
                document.getElementById('p1-flag').src = `https://flagcdn.com/w80/${Career.getCountryCode(m.p1.country)}.png`;
                document.getElementById('p1-name').textContent = m.p1.name + (m.p1.isCareerPlayer ? ' (YOU)' : '');
                document.getElementById('p1-legs').textContent = s.p1Score;
                document.getElementById('p1-remaining').textContent = s.p1Remaining;
                
                // Player 2
                document.getElementById('p2-flag').src = `https://flagcdn.com/w80/${Career.getCountryCode(m.p2.country)}.png`;
                document.getElementById('p2-name').textContent = m.p2.name + (m.p2.isCareerPlayer ? ' (YOU)' : '');
                document.getElementById('p2-legs').textContent = s.p2Score;
                document.getElementById('p2-remaining').textContent = s.p2Remaining;
                
                // Active player highlight
                document.getElementById('p1-box').classList.toggle('active', s.currentThrower === 1);
                document.getElementById('p2-box').classList.toggle('active', s.currentThrower === 2);
                
                // Leg info
                const throwerName = s.currentThrower === 1 ? m.p1.name : m.p2.name;
                document.getElementById('leg-info').textContent = `Leg ${s.legNumber} - ${throwerName} to throw`;
                
                // Visit log
                document.getElementById('visit-log').innerHTML = s.visitLog.slice(-10).map(v => 
                    `<div style="color:${v.checkout ? 'var(--pdc-green)' : '#888'};">${v.player}: ${v.score}${v.checkout ? ' ‚úì' : ''}</div>`
                ).join('');
            },

            throwDart: () => {
                const s = CareerMatch.state;
                const m = s.match;
                const player = s.currentThrower === 1 ? m.p1 : m.p2;
                const remaining = s.currentThrower === 1 ? s.p1Remaining : s.p2Remaining;
                
                // Use shared Engine to throw
                const visit = Engine.throwVisit(player, remaining);
                
                // Update remaining
                if (s.currentThrower === 1) {
                    s.p1Remaining -= visit.points;
                    s.p1TotalPoints += visit.points;
                    s.p1Darts += visit.dartsThrown;
                } else {
                    s.p2Remaining -= visit.points;
                    s.p2TotalPoints += visit.points;
                    s.p2Darts += visit.dartsThrown;
                }
                
                // Log visit
                s.visitLog.push({
                    player: player.name,
                    score: visit.points,
                    checkout: visit.endLeg
                });
                
                // Check for leg win
                if (visit.endLeg) {
                    CareerMatch.winLeg(s.currentThrower);
                } else {
                    // Switch thrower
                    s.currentThrower = s.currentThrower === 1 ? 2 : 1;
                    CareerMatch.renderMatch();
                }
            },

            simLeg: () => {
                const s = CareerMatch.state;
                
                // Simulate until leg ends
                while (s.p1Remaining > 0 && s.p2Remaining > 0) {
                    CareerMatch.throwDart();
                    if (!s.active) return; // Match might have ended
                }
            },

            simMatch: () => {
                const s = CareerMatch.state;
                const target = s.roundInfo.target;
                
                while (s.p1Score < target && s.p2Score < target) {
                    CareerMatch.simLeg();
                    if (!s.active) return;
                }
            },

            winLeg: (winner) => {
                const s = CareerMatch.state;
                const target = s.roundInfo.target;
                
                if (winner === 1) {
                    s.p1Score++;
                } else {
                    s.p2Score++;
                }
                
                // Check for match win
                if (s.p1Score >= target || s.p2Score >= target) {
                    CareerMatch.endMatch();
                } else {
                    // Reset for next leg
                    s.legNumber++;
                    s.p1Remaining = 501;
                    s.p2Remaining = 501;
                    // Alternate starter
                    s.legStarter = s.legStarter === 1 ? 2 : 1;
                    s.currentThrower = s.legStarter;
                    CareerMatch.renderMatch();
                }
            },

            endMatch: () => {
                const s = CareerMatch.state;
                const m = s.match;
                
                // Calculate averages
                const avg1 = s.p1Darts > 0 ? ((s.p1TotalPoints / s.p1Darts) * 3).toFixed(1) : '0.0';
                const avg2 = s.p2Darts > 0 ? ((s.p2TotalPoints / s.p2Darts) * 3).toFixed(1) : '0.0';
                
                // Update match result
                m.score = [s.p1Score, s.p2Score];
                m.winner = s.p1Score > s.p2Score ? m.p1 : m.p2;
                m.averages = [avg1, avg2];
                
                s.active = false;
                
                // Show result modal
                document.getElementById('result-winner').textContent = m.winner.name + ' WINS!';
                document.getElementById('result-score').textContent = `${s.p1Score} - ${s.p2Score}`;
                document.getElementById('result-avg-1').textContent = avg1;
                document.getElementById('result-avg-2').textContent = avg2;
                document.getElementById('match-result-modal').style.display = 'flex';
            },

            closeResult: () => {
                document.getElementById('match-result-modal').style.display = 'none';
                document.getElementById('match-screen').style.display = 'none';
                document.getElementById('tournament-screen').style.display = 'flex';
                
                CareerTournament.checkRoundComplete();
                CareerTournament.renderBracket();
            }
        };

        // Initialize on load - load from database first
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                console.log("[Career] Initializing career mode...");
                
                // Try to load players and tournaments from database
                const [dbPlayers, dbTournaments] = await Promise.all([
                    DataLoader.loadPlayers(),
                    DataLoader.loadTournaments()
                ]);

                // If we got players from DB, use them
                if (dbPlayers && dbPlayers.length > 0) {
                    PLAYERS_DB = dbPlayers.map(p => ({
                        name: p.name,
                        country: p.country ? p.country.toLowerCase() : 'england',
                        avg: p.avgMin ? (p.avgMin + p.avgMax) / 2 : (p.avg || 85),
                        co: p.checkoutMin ? (p.checkoutMin + p.checkoutMax) / 2 : (p.co || 35),
                        tourCard: p.tourCard !== false,
                        money: p.money || 0,
                        form: p.form || 50,
                        fatigue: p.fatigue || 0
                    }));
                    console.log("[Career] Loaded " + PLAYERS_DB.length + " players from database");
                } else {
                    // Generate filler players for defaults
                    generateDefaultPlayers();
                    console.log("[Career] Using " + PLAYERS_DB.length + " default players");
                }

                // If we got tournaments from DB, convert to career format
                if (dbTournaments && dbTournaments.length > 0) {
                    // Prize money by event type (same as darts.html)
                    const PRIZE_MONEY = {
                        'q-school': 0,
                        'challenge': 10000,
                        'players': 75000,
                        'minor': 175000,
                        'masters': 60000,
                        'winmaudm': 300000,
                        'wmasters-qual': 10000,
                        'premier-league': 50000,
                        'premier-league-playoff': 250000,
                        'uk-open': 500000,
                        'matchplay': 800000,
                        'grandprix': 600000,
                        'european-championship': 500000,
                        'pc-finals': 500000,
                        'grand-slam': 650000,
                        'grandslam': 650000,
                        'ws-finals': 300000,
                        'world': 2500000,
                        'et-qual-tc': 10000,
                        'et-host-nation': 10000,
                        'et-east-european': 10000,
                        'et-nordic-baltic': 10000,
                        'wc-qual-intl': 15000,
                        'wc-qual-tc': 15000,
                        'gs-qual-tc': 10000,
                        'ws-qual-tc': 10000
                    };
                    
                    EVENTS_DB = dbTournaments.map((t, idx) => {
                        const eventType = t.type || 'players';
                        return {
                            id: t.id || idx + 1,
                            name: t.name,
                            date: t.date || `Week ${idx + 1}`,
                            type: eventType,
                            format: t.format || 'legs',
                            players: t.players || 128,
                            prize: t.prize || PRIZE_MONEY[eventType] || 75000,
                            cardRequired: t.cardRequired === true,
                            location: t.location || null,
                            eligibleRegions: t.eligibleRegions || [],
                            region: t.region || null,
                            targetEvent: t.targetEvent || null,
                            slots: t.slots || null,
                            night: t.night || null
                        };
                    });
                    console.log("[Career] Loaded " + EVENTS_DB.length + " tournaments from database");
                } else {
                    console.log("[Career] Using " + EVENTS_DB.length + " default tournaments");
                }

                // Initialize career UI
                Career.init();
                Career.updateStartingStats();
                
                // Initialize auth system (shared with main game)
                await AuthSystem.init();
                
                console.log("[Career] Initialization complete");
            } catch (e) {
                console.error("[Career] Init error:", e);
                // Still initialize with defaults on error
                generateDefaultPlayers();
                Career.init();
                Career.updateStartingStats();
            }
        });
    </script>

    <!-- ACCOUNT BUTTON (Fixed Position) -->
    <button onclick="AuthSystem.showModal()"
        style="position: fixed; bottom: 35px; right: 12px; z-index: 9998; background: #0066cc; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">üë§
        ACCOUNT</button>

    <!-- VERSION FOOTER -->
    <div id="version-footer"
        style="position: fixed; bottom: 8px; right: 12px; font-size: 12px; color: #aaa; font-family: Arial, sans-serif; z-index: 9999; pointer-events: none; background: rgba(0,0,0,0.5); padding: 4px 8px; border-radius: 4px;">
        v1.0 | PDC Career Mode
    </div>
</body>
</html>
